







# **甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程**













[TOC]





# **1. 编写目的**

本文档为甘肃省人力资源和社会保障厅信息化总集成项目现场实施工作的流程规范文档，为现场实施人员提供实施工作参考。

# **2. 现场实施内容描述**

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps1.png)

本项目，需要完成的工作任务是将甘肃省人社厅数据的回流到地市库，这个业务数据流向大致描述为 省人社厅生产库->生产同步库->省市回流->地市库。

现场涉及业务范围如下：

1、公共服务业务数据同步

2、社会保险业务数据同步

3、机关保系统数据同步

4、劳动关系业务数据同步

5、就业创业业务数据同步

6、居民保业务数据同步

7、社保卡业务数据同步

8、人事人才业务数据同步

其他：

总集需求16张视图同步

总集需求日志表备份同步

就业需求4张政务表数据同步

就业需求3张表实时同步

纪委委办局需求

总集需求4张同步

总集需求1张同步

就业监管平台测试环境需求13视图同步

# **3. 现场部署情况**

ETL产品部署情况:

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps2.png)

DSP产品部署情况及节点分布：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps3.png)

 

# **4. 数据同步操作步骤**

## **4.1** 数据同步操作流程图

![image-20240626162219264](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\image-20240626162219264.png)

数据同步操作流程，常用执行顺序如下：

1) xstream配置，启用xstream组件，并分配xstream用户。
2) 新增节点，部署dsp节点程序。
3) 配置xstream通道。
4) 配置管道。
5) 进行异构数据库的表结构转换。
6) 创建表空间。
7) 创建表用户。
8) 对用户进行授权。
9) 表空间授权。
10) 创建表。
11) dsp增量配置，首次启动，记录当前日志记录的scn号。
12) 进行etl配置。
13) 执行etl全量操作。
14) 启动dsp增量。

## 4.2 操作步骤

### **4.2.1 Xstream设置**

为什么要开启Xstream，

因为在DSP中抽取Oracle数据使用Xstream这个插件，所以需要在Oracle中开启

#### 4.2.1.1 Xstream的开启步骤

连接数据库服务器，使用sysdba登录

sqlplus / as sysdba 

执行以下命令开启Xstream

alter system set enable_goldengate_replication=true; 

执行以下命令，检查日志归档是否已开启

archive log list;

若回显打印“Database log mode: No Archive Mode”，说明日志归档未开启

若回显打印“Database log mode: Archive Mode”，说明日志归档已开启

若未开启联系数据库运维方开启归档日志，已开启进行下面的查看数据文件，依次按照顺序切换CDB,PDB创建表空间 

--数据文件位置

select * FROM dba_data_files  --查询数据文件位置的语句

文件存放路径：+DATA/QTCTB/DATAFILE/

 --下面步骤是创建Xstream模式c##xstrmadmin管理员用户

alter session set container = CDB$ROOT; --切换到CDB模式下

create tablespace xstream_adm_tbs_tb datafile '+DATA/QTCTB/DATAFILE/xstream_adm_tbs_tb.dbf' size 128M reuse autoextend on maxsize unlimited; -- 在CDB中创建,创建表空间xstream_adm_tbs

 show pdbs; 查询容器数据库下所有的PDB实例（可插拔数据库），所有的PDB都要执行创建表空间语句

alter session set container = QTP_TB; --切换到PDB模式下，该PDB为QTP_TB

create tablespace xstream_adm_tbs_tb datafile '+DATA/QTCTB/DATAFILE/xstream_adm_tbs_tb_qtp_tb.dbf' size 128M reuse autoextend on maxsize unlimited; -- 在QTP_TB中创建,创建表空间

 例如该容器数据库下有2个PDB，假如第二个PDB名字是QTP_TB2

alter session set container = QTP_TB2; --切换到PDB模式下，该PDB为QTP_TB2

create tablespace xstream_adm_tbs_tb datafile '+DATA/QTCTB/DATAFILE/xstream_adm_tbs_tb_qtp_tb2.dbf' size 128M reuse autoextend on maxsize unlimited; -- 在QTP_TB2中创建,创建表空间

 alter session set container = CDB$ROOT; --切换到CDB模式下

 CREATE USER c##xstrmadmin IDENTIFIED BY xstrmadmin DEFAULT TABLESPACE xstream_adm_tbs_tb QUOTA UNLIMITED ON xstream_adm_tbs_tb CONTAINER=ALL; --创建c##xstrmadmin oracleXstream出站服务器管理员并授权已创建的表空间

GRANT CREATE SESSION, SET CONTAINER TO c##xstrmadmin CONTAINER=ALL; 

 BEGIN

DBMS_XSTREAM_AUTH.GRANT_ADMIN_PRIVILEGE(

  grantee         => 'c##xstrmadmin',

  privilege_type      => 'CAPTURE',

  grant_select_privileges => TRUE,

  container        => 'ALL'

 );

END;

/

--上面加斜杠的是方便在服务器里面好执行

--下面步骤是创建dsp使用c##xstrm普通用户

alter session set container = CDB$ROOT; --切换CDB  CDB$ROOT是固定的

CREATE TABLESPACE xstream_tbs DATAFILE '+DATA/QTCTB/DATAFILE/xstream_tbs.dbf' SIZE 128M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED; --在CDB中创建 其中xstream_tbs是名字

 alter session set container = QTP_TB; --切换PDB

CREATE TABLESPACE xstream_tbs DATAFILE '+DATA/QTCTB/DATAFILE/xstream_tbs_qtp_tb.dbf' SIZE 128M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED; --在PDB中创建

 --多个PDB都要执行创建普通用户使用的表空间

 alter session set container = CDB$ROOT; --切换CDB

 CREATE USER c##xstrm IDENTIFIED BY xstrm DEFAULT TABLESPACE xstream_tbs QUOTA UNLIMITED ON xstream_tbs CONTAINER=ALL; --创建dsp使用c##xstrm普通用户并授权已创建的表空间

 --以下皆是授权

GRANT CREATE SESSION TO c##xstrm CONTAINER=ALL;

GRANT SET CONTAINER TO c##xstrm CONTAINER=ALL;

GRANT SELECT ON V_$DATABASE to c##xstrm CONTAINER=ALL;

GRANT FLASHBACK ANY TABLE TO c##xstrm CONTAINER=ALL;

GRANT SELECT ANY TABLE to c##xstrm CONTAINER=ALL;

GRANT LOCK ANY TABLE TO c##xstrm CONTAINER=ALL;

grant select_catalog_role to c##xstrm CONTAINER=ALL;

GRANT EXECUTE_CATALOG_ROLE TO C##XSTRM CONTAINER=ALL; --新增权限项

 alter database add supplemental log data (all) columns; --修改日志记录参数

 **1.1.2.2** ***\*Xstream的参数配置\****

如果超过了0.9代表其数据库的压力较大，需要增加 streams_pool_size的内存 分配参数

查看这个数据的压力状态，查询的数据不能超过0.9

SELECT TOTAL_MEMORY_ALLOCATED/CURRENT_SIZE FROM V$STREAMS_POOL_STATISTICS;

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps5.jpg) 

 

show parameter stream;  查看当前的参数是多少

alter system set streams_pool_size=80g scope=both sid='*';       --修改 streams_pool_size=80g 具体多少大小即可。

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps6.jpg) 

登录数据库服务器，连接数据库。

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps7.jpg) 

根据服务器剩余内容来配置。

 

修改配置项，登录数据库服务器

 

-- 修改undo_retention参数值,单位为秒

ALTER SYSTEM SET UNDO_RETENTION=60000 SCOPE=BOTH SID='*';

 

-- 显示undo相关参数配置

SHOW PARAMETER UNDO_;

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps8.jpg) 

 

结束，该数据库服务器XSTREAM模式已开启

### **4.2.2 创建Xstream出栈服务**

#### **4.2.2.1** 正常方式创建

sqlplus  c##xstrmadmin/xstrmadmin@10.216.3.19:1522/SICGSDB  --登录社保Xstream管理员用户

或者通过navicat 连接 c##xstrmadmin用户

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps9.jpg) 

 将用户方需要使用的用户名和表，对应填入下方的代码

DECLARE

 tables DBMS_UTILITY.UNCL_ARRAY;

 schemas DBMS_UTILITY.UNCL_ARRAY;

BEGIN

 tables(1) := 'EINP_COLLECTION.AE38';

 tables(2) := 'EINP_COLLECTION.AE31';

 tables(3) := 'EINP_COLLECTION.AC50';

 tables(4) := 'EINP_COLLECTION.AC51';

 tables(5) := 'EINP_COLLECTION.AB18';

 tables(6) := 'EINP_COLLECTION.AB19';

 tables(7) := 'EINP_COLLECTION.AE22';

 tables(8) := 'EINP_COLLECTION.AB14';

 tables(9) := 'EINP_BASESTORE.AB99';

 tables(10) := 'EINP_BASESTORE.AC99';

 tables(11) := 'EINP_BASESTORE.AE97';

 tables(12) := 'EINP_BASESTORE.AE98';

 tables(13) := 'EINP_BASESTORE.AE99';

 tables(14) := 'EINP_FUNDFINANCE.AD50';

 tables(15) := 'EINP_FUNDFINANCE.AD51';

 tables(16) := 'EINP_FUNDFINANCE.AD66';

 tables(17) := 'EINP_SETTLE.IC65';

 tables(18) := 'EINP_SETTLE.IC66';

 tables(19) := 'EINP_SETTLE.IC67';

 tables(20) := 'EINP_SETTLE.IC68';

 tables(21) := 'EINP_SETTLE.IC70';

 tables(22) := 'EINP_SETTLE.IC71';

 tables(23) := 'EINP_SETTLE.IC72';

 tables(24) := 'EINP_SETTLE.IC73';

 tables(25) := 'EINP_SETTLE.IC74';

 tables(26) := 'EINP_SETTLE.IC75';

 tables(27) := 'EINP_SETTLE.IC76';

 tables(28) := 'EINP_SETTLE.IC77';

 tables(29) := 'EINP_SETTLE.IC78';

 tables(30) := 'EINP_SETTLE.IC87';

 tables(31) := 'EINP_SETTLE.IC88';

 tables(32) := 'EINP_SETTLE.IC89';

 tables(33) := 'EINP_SETTLE.IC90';

 tables(34) := 'EINP_SETTLE.IC91';

 tables(35) := 'EINP_SETTLE.IC92';

 tables(36) := 'EINP_SETTLE.IC95';

 tables(37) := 'EINP_SETTLE.IC96';

 tables(38) := 'EINP_SETTLE.IC97';

 tables(39) := 'EINP_PARAMETER.AA01';

 tables(40) := 'EINP_PARAMETER.AA02';

 tables(41) := 'EINP_PARAMETER.AA10';

 tables(42) := 'EINP_PARAMETER.AF01';

 tables(43) := 'EINP_PARAMETER.ZE80';

 schemas(1) := NULL;

 DBMS_XSTREAM_ADM.CREATE_OUTBOUND(

  server_name   =>  'td8',

  table_names   =>  tables,

  schema_names   =>  schemas);

END;

/

查看出栈服务器的状态

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps10.jpg) 

关闭出栈服务器。

BEGIN DBMS_XSTREAM_ADM.STOP_OUTBOUND(server_name => 'TD78',FORCE => TRUE);END;

执行之前一直一定要检查server_name的名字，不要误关闭

 exit

退出登录超级管理员

sqlplus / as sysdba 登录数据库超级管理员，运行下面的语句进行用户授权

 BEGIN

  DBMS_XSTREAM_ADM.ALTER_OUTBOUND(

   server_name  => 'td56',

   connect_user => 'c##xstrm'

  );

END;

/

/ 在服务器里面使用

出栈服务器创建成功

出站服务器一但建立就不能新增和修改了，所以通常会把业务的表都建好，但是表的情况灵活配置CDC

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps11.jpg) 

在CDC中可以不用将出栈服务器配置表都建完。根据实际情况配置,满足增量同步的配置，不满足的不配置，例如：表没有主键、表中含有大字段类型 如Clob，Blob。

 ![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps12.jpg) 

 Server_name 是出战服务器的名字，其他的都是固定的

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps13.jpg) 

对应上述的server_name

 ![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps14.jpg) 

在配置CDC的时候由Schema列表，就和上述一一对应。

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps15.jpg) 

#### **4.2.2.2** 异常方式创建

创建出栈服务器后查询CAPTURE状态报错,例如下图：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps16.jpg) 

 ![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps17.jpg) 

 原因就是 APPLIED_TIMESTAMP 时间 大于CAPTURED_TIMESTAMP 

验证方式：

SELECT CAPTURE_NAME, ERROR_NUMBER, ERROR_MESSAGE, 

FIRST_SCN, START_SCN, CAPTURED_SCN, APPLIED_SCN,

STATUS FROM DBA_CAPTURE WHERE CAPTURE_NAME LIKE '%TD56%';

这个sql语句可以查出 APPLIED_TIMESTAMP 和 CAPTURED_TIMESTAMP的时间数值

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps18.jpg) 

可以直接比对CAPTURED_SCN和APPLIED_SCN的值

如是APPLIED_SCN大于 CAPTURED_SCN的值，则是上述原因。

此时需要关闭出栈服务器和删除出栈服务器。

***\*异常方式创建步骤\****

exec DBMS_XSTREAM_ADM.DROP_OUTBOUND('TD104');  --删除出栈服务器用户是C##XSTRMADMIN

 APPLIED_TIMESTAMP 时间 大于CAPTURED_TIMESTAMP 的时候，ORACLE数据库中创建新出栈服务器步骤：

 使用C##XSTRMADMIN用户执行这些步骤

(1) 提取当前数据库的数据字典到归档日志中，生产同步库的归档日志保存时间时7天，如果步骤一在这三天内执行过一次，就不需要再次执行了，这个会消耗磁盘空间和数据库性能

BEGIN

DBMS_CAPTURE_ADM.BUILD;

END;

/

(2) 查询新提取的数据字典对应的最大SCN号，并记录后面要用

SELECT DISTINCT FIRST_CHANGE#, NAME, DICTIONARY_BEGIN FROM V$ARCHIVED_LOG WHERE NAME IS NOT NULL AND DICTIONARY_BEGIN='YES' ORDER BY FIRST_CHANGE# DESC;

(3) 创建用于CAPTURE线程存放捕获数据的队列

BEGIN

DBMS_STREAMS_ADM.SET_UP_QUEUE(

​	-- 队列表名

​	queue_table => 'Q$_JGB_HL_CDC_TABLE',  ---CDC名称，Q$_ 是固定的

​	-- 队列名称

​	queue_name  => 'Q$_JGB_HL_CDC'  

);

END;

 

(4) 创建CAPTURE

BEGIN

DBMS_CAPTURE_ADM.CREATE_CAPTURE(

  -- capture名称

  capture_name  => 'CAP$_TD56_20243',  ---CAP$是固定的 其中 TD56_20243 通道名加五个随机数字

  -- 步骤3创建的队列名称

  queue_name   => 'Q$_JGB_HL_CDC',  -- Q$_是固定的

  -- 步骤2查询出的SCN号码,指定该capture在捕获增量数据时的起始SCN号

  first_scn   =>  6678865902,

  -- capture类别，默认为Streams,需手动指定为XStream

  capture_class => 'XStream');

END;

(5) 创建出栈服务器，需要手动指定步骤4)创建的capture名称

DECLARE  

 tables DBMS_UTILITY.UNCL_ARRAY;  

 schemas DBMS_UTILITY.UNCL_ARRAY; 

BEGIN

 tables(1) := 'CSIACCOUNT.AB19';

 tables(2) := 'CSIACCOUNT.AB26';

 tables(3) := 'CSIACCOUNT.AB45';

 schemas(1) := 'CSIACCOUNT';

DBMS_XSTREAM_ADM.CREATE_OUTBOUND(

 server_name  => 'TEST_CDC',

 -- 步骤4创建的capture名称

 capture_name => 'CAP$_TD56_20243',

 table_names  => tables,

 schema_names => schemas);

END;

(6) 出栈服务器启动之后，状态也正常。

现在启动通道，需要检查该通道目录下的

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps19.jpg) 

CDC目录下是否有历史数据，如果有，删除该目录下文件。

注意如果之前创建过出栈服务器，后面删除了，可能就存在历史数据需要清楚，如果是第一次创建出栈服务器，则不需要。

#### **4.2.2.3** 出栈服务器参数配置

出栈服务器创建完成之后需要一下配置

(1) 开启Oracle数据库的出站服务器

(2) 登录C##Xstreamadmin用户，创建出站服务器，以以上述步骤创建出栈服务器

(3) 登录C##Xstreamadmin用户，查看出站服务器的状态，刚创建完一般为四个状态。

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps20.jpg) 

(5) 停止出栈服务器

BEGIN DBMS_XSTREAM_ADM.STOP_OUTBOUND(server_name => 'T56',FORCE => TRUE);END;

其中server_name 根据实际需求修改

(6) 再次查看出站服务器的状态，没有上述四个状态，即为停止成功。

(7) 修改出栈服务器的参数配置

 a、查看所有出栈服务器的CAPTURE_NAME 状态

SELECT CAPTURE_NAME, ERROR_NUMBER, ERROR_MESSAGE, 

-- FIRST_SCN, START_SCN, CAPTURED_SCN, APPLIED_SCN,

(SELECT SCN_TO_TIMESTAMP(CAPTURED_SCN) FROM DUAL) CAPTURED_TIMESTAMP,

(SELECT SCN_TO_TIMESTAMP(APPLIED_SCN) FROM DUAL) APPLIED_TIMESTAMP,

STATUS FROM DBA_CAPTURE

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps21.jpg) 

B、查看单独的出站服务器的CAPTURE_NAME:

WHERE CAPTURE_NAME LIKE '%TD56%';

 C、根据CAPTURE_NAME的名字去修改参数配置

-- 设置检查点数据保存时间，单位天，如果这只成.25, 表示保留6小时

BEGIN

DBMS_CAPTURE_ADM.ALTER_CAPTURE(

CAPTURE_NAME=>'CAP$_TD56_83201',

CHECKPOINT_RETENTION_TIME=>8);

END;

 -- 设置检查点的频率，如果redo log超过300MB，建议设置成1000

BEGIN

DBMS_CAPTURE_ADM.SET_PARAMETER('CAP$_TD56_83201','_CHECKPOINT_FREQUENCY','500');

END;

替换其中的CAPTURE_NAME参数名，替换成功后实行sql语句。

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps22.jpg) 

上述参数，只在创建出出栈服务器的时候执行一次。删除后重建需要在执行一次。

 (8) 修改出栈服务器参数之后，启动出栈服务器

 BEGIN  DBMS_XSTREAM_ADM.START_OUTBOUND(

 server_name => 'TD56');

END;

需要修改server_name;

启动成功后，查看出站服务器的状态，为四个状态即可。

 (9) 通道启动一般出栈服务器的状态将变为五个

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps23.jpg) 

 以上出栈服务器配置完成。

 (10) 单独启停CAPTURE线程 (该步骤是运维步骤)

停止CAPTURE线程

BEGIN

 DBMS_CAPTURE_ADM.STOP_CAPTURE(

  capture_name => 'CAP$_TD89_1031',

  force   => true);

END;

 commit;  (执行一次停止或启动sql语句之后需要执行一次commit，提交事务)

 启动CAPTURE线程

BEGIN

 DBMS_CAPTURE_ADM.START_CAPTURE(

  capture_name => 'CAP$_TD89_1031');

END;

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps24.jpg) 

 

启动apply应用的

BEGIN DBMS_APPLY_ADM.START_APPLY(apply_name => 'TD1');END;

停止apply应用的

BEGIN DBMS_APPLY_ADM.STOP_APPLY(apply_name => 'TD1', FORCE => TRUE);END;

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps25.jpg) 

 

查看出栈服务器apply的状态

SELECT APPLY_NAME, 

​    STATUS,

​    ERROR_NUMBER,

​    ERROR_MESSAGE

 FROM DBA_APPLY

 WHERE PURPOSE = 'XStream Out';

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps26.jpg)

### **4.2.3** **Oracle数据库注意事项**

Oracle需要注意：

（1）oracle数据库中没有库的概念，一般是新建用户，在用户新建表，在此之前一定要新建表空间。

下面的附件是Oracle的用户以及表空间的创建方法

1. PLSQL客户端登录，点击钥匙可进行切换用户
2. 点击myobject 可以看到当前用户和连接串，右下角。
3. Oracle创建表空间：create tablespace DATA datafile '+DATA/QTCTB/DC71E1FE7B02233EE0532803D80AE7ED/DATAFILE/DATA2000.DBF' size 30720m;**-- DATA****表空间名字，****XXXXX.DBF****为数据文件路径，****30720m****为表空间大小。** 
4. 删除表空间和所属数据文件：drop tablespace xxxx including contents and datafiles;--xxx为表空间名称
5. Oracle表空间下的单个数据文件最大不能超过32G，表空间超过32G时需扩大表空间，扩大表空间可给当前表空间新增.dmp数据文件来实现：alter tablespace DATA add datafile '+DATA/QTCTB/DC71E1FE7B02233EE0532803D80AE7ED/DATAFILE/DATA1.DBF' size 30720m;
6. 创建用户：create user einp_collection –用户名 identified by –密码EINP_COLLECTION default tablespace –默认表空间 DATA temporary tablespace –临时表空间 TEMP;
7. 删除用户：drop user user_name cascade;
8. 修改用户密码：alter user einp_collection identified by EINP_COLLECTION;**--****修改用户密码。**
9. 查询用户下的所有表信息：SELECT c.OWNER, c.* FROM all_tables c where c.OWNER = 'EINP_COLLECTION';**-- c.OWNER = '****用户名大写****'****。**
10. 查询所有用户：select * from all_users;
11. 授权DBA权限：GRANT DBA TO gskq; --gskq为用户名
12. 查询当前用户授予的角色权限：select * from user_role_privs; --一般查询是否是DBA
13. 查看当前用户表空间：SELECT c.* FROM user_users c;
14. 查看所有用户表空间：select * from Dba_Tablespaces;
15. 新增的用户A登录时填写的数据库名（服务名）和创建A用户的管理员用户是默认使用同一个数据库名。
16. 查看用户所属表空间：select default_tablespace from dba_users where username='';
17. 查询所有用户及使用的表空间：select username,default_tablespace from dba_users;
18. Oracle查看PDB表空间使用情况：

select dbf.tablespace_name,

​    (dbf.totalspace - dfs.freespace) / 1024 "使用总量(G)"

 from (select t.tablespace_name,

​        sum(t.bytes) / 1024 / 1024 totalspace,

​        sum(t.blocks) totalblocks

​     from dba_data_files t

​     group by t.tablespace_name) dbf,

​    (select tt.tablespace_name,

​        sum(tt.bytes) / 1024 / 1024 freespace,

​        sum(tt.blocks) freeblocks

​     from dba_free_space tt

​     group by tt.tablespace_name) dfs

where trim(dbf.tablespace_name) = trim(dfs.tablespace_name)

order by dbf.tablespace_name;

19. 创建表空间要赋予用户的权限：

    alter user EINP_COLLECTION quota unlimited on DATA;**-- EINP_COLLECTION****为用户，DATA为表空间。** 

20. 查询当前用户角色：select * from dba_role_privs where grantee='EINP_BASESTORE'; 

21. 查询所有PDB表空间大小：

    select tablespace_name, sum(bytes)/1024/1024 from dba_data_files group by tablespace_name; **--** **查询单位为****MB。**

select tablespace_name, sum(bytes)/1024/1024/1024 from dba_data_files group by tablespace_name; **--** **查询单位为****GB****。**

22. 查询该表空间有多少个数据文件和大小：

    select file_name,bytes/1024/1024 from dba_data_files where tablespace_name like '表空间名称';

23. Expdp&impdp：

chown -R oracle:oinstall /data

CREATE DIRECTORY DATA_DP AS '/data';

grant read,write on directory DIR_DP to tbadmin;

expdp：gssidba/********@//10.192.65.43/orclpdb1 directory=data_oradmp_dir dumpfile=20220502_%U.dmp logfile=20220502_exp.log schemas=EINP_BASESTORE,EINP_TREATMENT,CSITREATMENT,EINP_BASICINFO,EINP_COLLECTION,EINP_SETTLE,CSIRELATION,CSIACCOUNT network_link=DBLINK_41 cluster=no parallel=8

impdp：impdp tbadmin/tbadmin@10.216.3.44:1522/qtp_tb dumpfile=20220502_%U.dmp logfile=20220511_imp.log full=y directory=data_oradmp_dir EXCLUDE=INDEX PARALLEL=8 cluster=no

impdp:gssidba/********@//10.192.65.43/orclpdb1 directory=data_oradmp_dir dumpfile=20220502_%U.dmp logfile=20220502_imp.log REMAP_SCHEMA=EINP_BASESTORE:EINP_BASESTORE,EINP_SETTLE:EINP_SETTLE,EINP_TREATMENT:EINP_TREATMENT,CSITREATMENT:CSITREATMENT,EINP_BASICINFO:EINP_BASICINFO,EINP_COLLECTION:EINP_COLLECTION,CSIRELATION:CSIRELATION,CSIACCOUNT:CSIACCOUNT tables=CSIACCOUNT.AC53,CSIRELATION.AB01EX,CSIRELATION.AB03,CSIRELATION.AB66,CSIRELATION.AB67,CSIRELATION.AB68,CSIRELATION.AC01EX TABLE_EXISTS_ACTION=truncate EXCLUDE=INDEX PARALLEL=8 cluster=no

24. 删除表空间：drop tablespace DATA2031 including contents and datafiles;
25. 报错：ORA-14404: partitioned table contains partitions in a different tablespace

解决：select x.table_name, x.partition_name, x.tablespace_name, y.tablespace_name 

from dba_tab_partitions x, dba_tab_partitions y

where x.tablespace_name = 'DATA2000' AND y.tablespace_name <> 'DATA2000' 

   AND x.table_name = y.table_name;

查询表空间把所属的表删除了，就可以删除表空间了

26. Expdp\impdp创建目录对象：CREATE DIRECTORY data_oradmp_dir AS '/data/data_oradmp_dir';

查看目录对象：select * from dba_directories;

删除目录对象：drop directory data_oradmp_dir;

27. 查询库中所有表数据量大小，从大到小排序：select a.num_rows,a.* from all_tables a where a.num_rows>0 order by a.num_rows desc;
28. 查看oracle数据库sid（实例名）的方法：select instance_name from V$instance;

Linux：echo $ORACLE_SID

29. 批量更新：update einp_collection.AC96 set aae828='9' where aaz690 in (select t.aaz690 from(select aaz690 from einp_collection.AC96 where aae828='0') t where rownum < 100001);

commit;

执行sql更新后需要commit;提交事务，PLSQL工具执行更新后不自动提交事务，Navicat会自动提交事务

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps1.jpg) 

30. 查询Oracle19C容器数据库CDB下表空间使用大小：

SELECT UPPER(F.TABLESPACE_NAME) "tablespace_name",

D.TOT_GROOTTE_MB "tablespace_size(M)",

D.TOT_GROOTTE_MB - F.TOTAL_BYTES "used_size(M)",

TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,2),'990.99') || '%' "per",

F.TOTAL_BYTES "idle_size(M)",

F.MAX_BYTES "max_block(M)"

FROM (SELECT TABLESPACE_NAME,

ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES,

ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES

FROM SYS.DBA_FREE_SPACE

GROUP BY TABLESPACE_NAME) F,

(SELECT DD.TABLESPACE_NAME,

ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB

FROM SYS.DBA_DATA_FILES DD

GROUP BY DD.TABLESPACE_NAME) D

WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME;

31. 清空表信息并处理碎片：Truncate table einp_collection6201.AC96 reuse storage;
32. 查看db_unique_name、db_name、instance_name需登录Oracle服务器中登录后通过命令行输出：

查看db_unique_name：show parameter db_unique_name;

查看db_name：show parameter db_name;

查看instance_name：show parameter instance_name;

​	

|                | 单实例                                  | RAC          | Dataguard      |
| -------------- | --------------------------------------- | ------------ | -------------- |
| DB_NAME        | 本地唯一                                | 不同实例相同 | 备库和主库相同 |
| DB_UNIQUE_NAME | 全局唯一                                | 不同实例相同 | 备库和主库不同 |
| INSTANCE_NAME  | 不唯一,如果和数据库名字一样，则本地唯一 | 不同实例不同 | 备库和主库不同 |

33. 查询并杀掉数据库连接：

select username,sid,serial#,paddr from v$session where username='EINP_BASICINFO';--用户名要大写，小写显示失败

alter system kill session '2233,8136';

34. 查询正在导入的DMPjob作业，进入作业并kill掉

SELECT * FROM user_datapump_jobs;

impdp tbadmin/tbadmin@10.216.3.44:1522/qtp_tb attach=SYS_IMPORT_FULL_01;

kill_job;

35. Imp导入语法：imp tbadmin/tbadmin@10.216.3.40:1521/qtp_tb file=/data/gfadmin/gfadmin.dmp fromuser=GFADMIN touser=GFADMIN ignore=y log=a.log; -- fromuser就是把当前的dmp文件中的某一个用户下的数据取出。touser就是把现在dmp文件中的数据导入到目标库的指定user下。ignore=y 告诉当前IMP如果当前表存在就不创建表结构而直接导入新的数据。
36. 查询数据库scn号：SELECT TIMESTAMP_TO_SCN(TO_DATE('2022-06-21 18:00:00', 'yyyy-mm-dd hh24:mi:ss')) FROM DUAL;
37. 将查询的scn号变更为对应的时间：select scn_to_timestamp(1263291) from dual;--其中1263291为scn号具体的值。
38. Oracle容器数据库切换cdb、pdb用户：

alter session set container = CDB$ROOT;

alter session set container=pdb1;

39. alter system kill session '20211,14974'; --杀掉TNS

select spid, osuser, s.program from v$session s, v$process p where s.paddr = p.addr and s.sid =7021; --根据sid查找SPID进程

kill -9 167306 --使用root用户杀掉该TNS进程，SPID号

40. 查询表空间使用率（全）：SELECT a.tablespace_name,a.bytes / 1024 / 1024 "tablespace_size(M)",(a.bytes - b.bytes) / 1024 / 1024 "used_size(M)",b.bytes / 1024 / 1024 "idle_size(M)",round(((a.bytes - b.bytes) / a.bytes) * 100, 2) "use_rate" FROM (SELECT tablespace_name, sum(bytes) bytes FROM dba_data_files GROUP BY tablespace_name) a, (SELECT tablespace_name, sum(bytes) bytes, max(bytes) largest FROM dba_free_space GROUP BY tablespace_name) b WHERE a.tablespace_name = b.tablespace_name
41. 查询表空间使用率：

SELECT UPPER(F.TABLESPACE_NAME) "表空间名",

​    D.TOT_GROOTTE_MB "表空间大小(M)",

​    D.TOT_GROOTTE_MB - F.TOTAL_BYTES "已使用空间(M)",

​    TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,

​           2),

​        '990.99') "使用比",

​    F.TOTAL_BYTES "空闲空间(M)",

​    F.MAX_BYTES "最大块(M)"

 FROM (SELECT TABLESPACE_NAME,

​        ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES,

​        ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES

​     FROM SYS.DBA_FREE_SPACE

​     GROUP BY TABLESPACE_NAME) F,

​    (SELECT DD.TABLESPACE_NAME,

​        ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB

​     FROM SYS.DBA_DATA_FILES DD

​     GROUP BY DD.TABLESPACE_NAME) D

 WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME

 ---- AND D.TABLESPACE_NAME = 'SYSTEM'

 ORDER BY 4 DESC;

42. select name,value from v$diag_info; --查询oracle alter和trance日志信息所在位置
43. DROP index EINP_BASICINFO.IDX_AB01_AAE858; --删除索引，用户名.索引名
44. SELECT * FROM dba_profiles WHERE profile='DEFAULT' AND resource_name='PASSWORD_LIFE_TIME';

ALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME UNLIMITED; --查询数据库用户过期时间，并授权永久期限

45. SELECT l.session_id    sid,

​    s.serial#,

​    l.locked_mode   锁模式,

​    l.oracle_username 登录用户,

​    l.os_user_name   登录机器用户名,

​    s.machine     机器名,

​    s.terminal     终端用户名,

​    o.object_name   被锁对象名,

​    s.logon_time    登录数据库时间

 FROM v$locked_object l, all_objects o, v$session s

 WHERE l.object_id = o.object_id

  AND l.session_id = s.sid

 ORDER BY sid, s.serial#;--查询锁表情况

### **4.2.4** **新增节点**

1、对于新服务器来说，第一次安装节点需要配置环境变量

将这个目录下的instantclient-basic-linux.x64-19.14.0.0.0dbru.zip解压

后面连同jdk一起将路径配置到环境变量里面

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps28.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps29.jpg) 

2、登录dsp的页面，点击节点管理

 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps30.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps31.jpg) 

 

其中机器端口不能冲突，可以根据节点管理页面，查看该服务器现在有几个端口在使用

例如42服务器

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps32.jpg) 

目前仅使用2088端口

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps33.jpg) 

使用2188端口，点击保存

 

进入需要装节点的服务器，解压node.tar.gz

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps34.jpg) 

进入 bin目录下

./startup.sh  启动

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps35.jpg) 

 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps36.jpg) 

 

 

节点内存修改

Vim bin/startup.sh

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps37.jpg) 

修改成 8G - 24G都行。

服务器需要需要10G左右的空余。

###  **4.2.5** **建立通道**

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps38.jpg) 

注：通道名称符合业务描述，清晰直观

同步模式默认是列需要修改成行

 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps39.jpg) 

***\*推送功能的使用场景：\****

源端数据DDL语句变动（修改和新增字段）的时候，通道的状态会变成挂起，去查看管道日志，根据日志情况分析，如果只是新增了字段，就返回通道列表页，停止该通道。去目标端数据库找到具体用户下的具体表和源端数据库的表结构保持一致。修改完成之后点击通道的推送功能。点击完了启动通道。

### **4.2.6** **建立管道**

点击通道名字，进入管道列表页，建立管道

 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps40.jpg)默认修改为否

 

 

### **4.2.7** **mysql转oracle(手动)**

Mysql数据表：

/*
 Navicat Premium Data Transfer

 Source Server         : 就业创业正式库mysql-10.216.192.10
 Source Server Type    : MySQL
 Source Server Version : 50731
 Source Host           : 10.216.192.10:3306
 Source Schema         : lm-ag

 Target Server Type    : MySQL
 Target Server Version : 50731
 File Encoding         : 65001

 Date: 19/03/2024 18:31:24
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for ccc3
-- ----------------------------
DROP TABLE IF EXISTS `ccc3`;
CREATE TABLE `ccc3`  (
  `CCC311` bigint(20) NOT NULL COMMENT '主键',
  `AAC001` bigint(20) NOT NULL COMMENT '个人编号',
  `CCC301` varchar(4) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '配置年份',
  `CCC101` bigint(20) NULL DEFAULT NULL COMMENT '待遇调整配置表主键',
  `CCC201` bigint(20) NULL DEFAULT NULL COMMENT '待遇调整记录表主键',
  `CCC302` decimal(15, 2) NULL DEFAULT NULL COMMENT '调整金额',
  `CCC303` decimal(6, 2) NULL DEFAULT NULL COMMENT '年度有效工龄',
  `CCC304` decimal(12, 2) NULL DEFAULT NULL COMMENT '上一年工资比例',
  `CCC103` decimal(6, 2) NULL DEFAULT NULL COMMENT '工龄年度比例',
  `CCC305` decimal(6, 2) NULL DEFAULT NULL COMMENT '根据档案出生日期变量',
  `CCC306` decimal(12, 2) NULL DEFAULT NULL COMMENT '上年平均工资',
  `CCC104` decimal(6, 2) NULL DEFAULT NULL COMMENT '比例常量',
  `CCC105` decimal(12, 2) NULL DEFAULT NULL COMMENT '调整固额(ccc1表)',
  `AAE100` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '有效标志',
  `AAE013` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '备注',
  `AAB080` datetime(0) NULL DEFAULT NULL COMMENT '申报时间',
  `AAE012` varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '受理人姓名',
  `AAE017` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '受理机构',
  `AAE036` datetime(0) NULL DEFAULT NULL COMMENT '受理时间',
  `AAE011` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '受理人编号',
  `BAE017` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '隶属机构编号',
  `BZE001` varchar(2) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '数据来源',
  `AAE163` datetime(0) NOT NULL COMMENT '时间戳',
  PRIMARY KEY (`CCC311`) USING BTREE,
  INDEX `ccc3_AAC001_IDX`(`AAC001`) USING BTREE,
  INDEX `ccc3_AAE100_IDX`(`AAE100`) USING BTREE,
  INDEX `ccc3_AAE017_IDX`(`AAE017`) USING BTREE,
  INDEX `ccc3_AAE036_IDX`(`AAE036`) USING BTREE,
  INDEX `ccc3_BAE017_IDX`(`BAE017`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '退休待遇调整配置表' ROW_FORMAT = Dynamic;

SET FOREIGN_KEY_CHECKS = 1;

转换成oracle

CREATE TABLE LM_BI.CCC3  (
  CCC311 NUMBER(20),
  AAC001 NUMBER(20),
  CCC301 varchar2(500),
  CCC101 NUMBER(20),
  CCC201 NUMBER(20),
  CCC302 decimal(15, 2),
  CCC303 decimal(6, 2),
  CCC304 decimal(12, 2),
  CCC103 decimal(6, 2),
  CCC305 decimal(6, 2),
  CCC306 decimal(12, 2),
  CCC104 decimal(6, 2),
  CCC105 decimal(12, 2),
  AAE100 varchar2(500),
  AAE013 varchar2(500),
  AAB080 TIMESTAMP(0), 
  AAE012 varchar2(500), 
  AAE017 varchar2(500), 
  AAE036 TIMESTAMP(0), 
  AAE011 varchar2(500), 
  BAE017 varchar2(500), 
  BZE001 varchar2(500),
  AAE163 TIMESTAMP(0),
  CONSTRAINT PK_CCC3 PRIMARY KEY(CCC311)
); 

转化注意事项：

1、只保留CREATE主体

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps43.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps44.jpg) 

2、去除 ` 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps45.jpg) 

3、去除注释，只留逗号

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps46.jpg) 

4、mysql中bigint、int 转成oracle  NUMBER，数值不变

5、Mysql中varchar 转成oracle varchar2，数值是mysql的三倍。

6、Mysql中datetime 转成oracle TIMESTAMP，数值不变

7、Mysql中decimal 不用变

8、Mysql中date 不用变，只留date字段，没有数值，例如DATE,

9、Mysql中主键 PRIMARY KEY (`CCC311`) USING BTREE 转成 CONSTRAINT PK_CCC3 PRIMARY KEY(CCC311)

10、Mysql中索引删除

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps47.jpg) 

11、oracle表名必须大写，且要带用户名.表名

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps48.jpg) 

### **4.2.8 建立表映射关系**

点击管道名字，进入表映射列表页，建立表映射关系。

可以批量建设表映射关系

例如： 

源端用户名,表名,源端数据源序号,目标端用户名,表名,目标端数据源序号 

EINP_BASESTORE,AB99,70,einp_basestore,ab99,73

EINP_BASESTORE,AC99,70,einp_basestore,ac99,73

HRSS_BI,AB97,70,hrss_bi,ab97,73

HRSS_BI,AB98,70,hrss_bi,ab98,73

HRSS_BI,AC97,70,hrss_bi,ac97,73

HRSS_BI,AC98,70,hrss_bi,ac98,73

 

常用数据源序号:

省市回流库 43

生产同步库 44

社保生产库 70

常用基本都在前三四页

 

出栈服务器启动之后，状态也正常。

现在启动通道，需要检查该通道目录下的

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps49.jpg) 

CDC目录下是否有历史数据，如果有，删除该目录下文件。

注意如果之前创建过出栈服务器，后面删除了，可能就存在历史数据需要清楚，如果是第一次创建出栈服务器，则不需要。

 

### **4.2.9 通道的业务逻辑**

#### **4.2.9.1** 通道之间的业务关系

(1) 通道1，通道2、通道6 停用了，但没有删除

(2) 通道3和通道7公服系统(A)-->生产同步库业务(B)

(3) 通道8、9、11、12、13、14、15 社保企业业务EINP(A) ---> 生产同步库业务(B) 所有业务库(A) 到生产同步库(B)都是一对一关系

(4) 通道4、5、24、25、26、27 属于社保企业业务，生产同步库(B)--> 省市回流库(C)

(5) 通道22、23、28、29、30、31、32、33、38、39、40、41、42、43、44、65 该16个通道属于社保企业业务EINP，省市回流库(C)--> 16个地市(D)

 

(6) 通道16、21  生产同步库(B) --> 交换库(需求库，单独的库，不同省市回流库和生产同步库)目前是停止状态，未来可能会开启。

(7) 通道17、18、19、20 停用了，但没有删除

 

(8) 通道35、36、37 都是A ----> A的，具体详见通道名

(9) 通道35 是劳动关系的

(10) [通道46属于社保机关业务CSI(A) ------>  生产同步](http://10.216.12.34:8089/pipeline_list.htm?channelId=49)(B)

(11) 通道47、48 属于社保机关业务CSI业务系统的，生产同步库(B) -----> 省市回流(C)

(12) 通道49--64 该16个通道属于社保机关和居民业务CSI业务系统的，省市回流库(C)--> 16个地市(D)  49-64的cdc都参考49，都一样

 

(13) 通道34 属于劳动关系库(A)---> 生产同步库(B)的大屏展示信息表

(14) 通道66 [劳动正式Mysql(A) -----> 生产同步库(](http://10.216.12.34:8089/pipeline_list.htm?channelId=69)B)

(15) 通道90 属于劳动关系系统，生产同步库(B) -----> 省市回流(C)

(16) 通道91--95 属于劳动关系系统，省市回流库(C)--> 15个地市(D) --该回流没有兰州

 

(17) 通道45 就业创业(A) ------> 生产同步库(B)的大屏展示信息表

(18) 通道67、68、96 属于就业创业(A) -----> 生产同步库(B)

(19) 通道69、70 、100属于就业创业系统，生产同步库(B) -----> 省市回流(C) 

(20) 通道71、72、98 属于就业创业 10主库 --- 11备库  ---- 属于数据库备份

(21) 通道73--87 该15个通道属于就业创业系统，省市回流库(C)--> 15个地市(D) --该回流没有兰州

(22) 通道101 属于就业创业系统，省市回流库(C)--> 张掖市(D) --那158张表

(23) 通道97 [生产同步(B) ---> 就业正式](http://10.216.12.34:8089/pipeline_list.htm?channelId=100)(A)

 

(24) 通道88 [城乡居民CSI(A) ----> 生产同步](http://10.216.12.34:8089/pipeline_list.htm?channelId=91)(B)

(25) 通道89 [生产同步(B) ----> 省市回流_城乡居民CSI](http://10.216.12.34:8089/pipeline_list.htm?channelId=92)(B)

(26) 通道49--64 该16个通道属于社保机关和居民业务CSI业务系统的，省市回流库(C)--> 16个地市(D)

 

(27) 通道99 人事人才的需求，需要社保库同步六张表到人事人才的库，但是社保的数据库不稳定，现在是从生产同步库里面获取数据到人事人才的  B ---->A

#### **4.2.9.2** 通道之间上下级关系的定位

做通道的全量的时候需要找到该通道的上一级，关闭上一级通道，才能做该通道的全量

是B-C做全量，定位A-B的通道

##### **4.2.9.2.1** oracle数据库的上一级通道的定位

例如27通道做全量，首先要做找到27的业务系统是哪个？

该27属于社保企业系统(B) --> 省市回流(C) 此时需要找到27的上级通道。该上级通道必在社保企业A --- 生产同步库B 里 如下图：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps50.jpg) 

必在8、9、11、12、13、14、15

再以上通道中具体定位：

打开CDC通道抽取分配文件：通过CDC的用户和表名去配合上下级关系，

例如下图：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps51.jpg) 

 

##### **4.2.9.2.2** Mysql数据上一级通道的定位

象劳动关系和就业的源端(A) 都是mysql数据库，这样如何定位其通道和通道的上下级关系？

例如：通道70通道做全量，如何定位70的上级通道是那个？

70 属于就业创业系统，他的上级通道就一定在就业创业系统的 A-B里面

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps52.jpg) 

例如上图就在 67，68，96里面找

如何在这三通道定位正确的通道

还是先看CDC 通道70中的用户名和表名

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps53.jpg) 

如图：通道70中LM_EC做全量，找到他的上一级通道，进入

E:\工作\项目合集\甘肃项目\甘肃人社项目资料汇总\劳动关系、就业数据同步

该目录下记录了所有劳动关系、就业的通道关系。

点击 就业创业_生产同步库DSP通道映射配置记录 目录

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps54.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps55.jpg) 

至此通过用户名找到70的上一级通道68  

##### 4.2.9.2.3 省市回流 -- 地市 全量的通道定位

首先需要找到 C-D的所在系统，如果C-D属于社保下机关和城乡居民系统，那就要找机关的B-C通道停止和城乡居民B-C通道停止。

在停止具体要做的C-D通道，例如通道57 是省市回流库--->酒泉地市库的机关居民回流通道

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps56.jpg) 

  通道57是属于机关和居民的，做全量的话需要停止机关系统和城乡居民系统

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps57.jpg) 

47、48是57的机关的上一级通道，使用数据泵做全量的话，需要将这两个通道都停了

在找57的城乡居民的上一级通道

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps58.jpg) 

89是57的城乡居民通道的上一级通道，使用数据泵做全量的话，需要将这个通道都停了

 

生产同步库(B)--> 省市回流

### **4.2.10 生产同步库(B)--> 省市回流库(C)分流规则**

a、一对一关系：由于存在部分业务表不分流的情况。不分流的意思就是：一张表十万数据给所有地市库都是十万数据，同等接收十万数据。一对一关系在省市回流库创建不分流用户，例如生产同步库用户为：CSIACCOUNT 省市回流库也为CSIACCOUNT

如图，生产同步库和省市回流库都为CSIACCOUNT

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps59.jpg)![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps60.jpg) 

 

b、一对十七关系：大部分业务表符合分流的情况，根据表中的各地市区划编码字段进行分流数据，例如：社保系统分流字段为AAB359和AAA431,取前四位区划编码值，例如6201 兰州、6202 嘉峪关、6203 金昌、6204 白银、6205 天水、6206 武威、6207 张掖、6208 平凉、6209 酒泉、6210 庆阳、6211 定西、6212 陇南、6229 临夏回族自治州、6230 甘南藏族自治州、6270 甘肃矿区、6271 兰州新区、6299 省本级，一共17个地市

一对十七关系：在省市回流库创建分流用户，例如：生产同步库用户为：CSIACCOUNT 省市回流库为CSIACCOUNT6201--CSIACCOUNT6299

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps61.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps62.jpg) 

 

不分流的映射关系的创建：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps63.jpg) 

CSIACCOUNT,AC53,44,CSIACCOUNT,AC53,43

 

分流表的映射关系的创建:

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps64.jpg) 

CSIACCOUNT,AC53,44,CSIACCOUNT6201,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6202,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6203,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6204,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6205,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6206,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6207,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6208,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6209,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6210,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6211,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6212,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6229,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6230,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6270,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6271,AC53,43

CSIACCOUNT,AC53,44,CSIACCOUNT6299,AC53,43

一对十七 一张表对应十七个目标端用户表

上面的44和43 代表数据源ID

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps65.jpg) 

 

映射关系创建完成后，开始批量配置分流条件。

http://10.216.12.33:8081/data_media.html

访问该地址

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps66.jpg) 

package com.alibaba.otter.node.extend.processor;

 

import com.alibaba.otter.node.extend.processor.AbstractEventProcessor;

import com.alibaba.otter.shared.etl.model.EventColumn;

import com.alibaba.otter.shared.etl.model.EventData;

 

public class CustomEventProcessor extends AbstractEventProcessor {

  @Override

  public boolean loadProcess(EventData eventData) {

​    EventColumn column = getColumn(eventData, "AAB359");

​    if (column == null || column.isNull()) {

​      return false;

​    }

​    if (eventData.getEventType().isDelete()) {

​      return true;

​    }

​    if (eventData.getPairId() == %id%) {

​      return column.getColumnValue().startsWith("%areaCode%");

​    }

​    return false;

  }

}

###  **4.2.11 数据全量同步的注意事项**

关闭要做全量的通道 -----> 查看这个通道有没有上一级通道关闭(主要是通过用户名和表来查看) ---->清楚目标端数据库量 ------> 批量创建ETL文件 ----> ETL做全量 -----> 启动目标端源端通道。

#### **4.2.11.1** ETL的使用流程

##### **4.2.11.1.1** ETL基本使用流程

1、打开ETL，首先需要连接资源库

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps67.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps68.jpg) 

2、开始建立源端和目标端

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps69.jpg)![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps70.jpg) 

 

3、连接服务器

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps71.jpg) 

 

4、点击组件视图

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps72.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps73.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps74.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps75.jpg) 

 

批量部署

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps76.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps77.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps78.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps79.jpg) 

 

远程部署具体的目录：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps80.jpg) 

 

 

有时候连接oracle19c数据的时候可以会连接失败，这时候可以尝试更换jar

在libext目录下ojdbc8.jar ，默认是ojdbc6.jar

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps81.jpg) 

 

##### **4.2.11.1.2** ETL分区配置

解决单线程数据量同步慢问题

ETL服务端基础环境中核心线程数来确定分区上限（例如：16C32G，支持最高16个分区）

 步骤一：

在《资源视图》-->《分区模式》中新建分区（分区数量根据情况设定，例如建立3个分区，分区ID分别为：0、1、2）

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps2.jpg)![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps3.jpg) 

步骤二：

 例如：SQL查询组件+数据库记录插入组件

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps4.jpg) 

（1）查询组件先select * from ‘表名’ ,原因：保证后面入库组件能获取到“字段类型”，确保其映射成功；

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps5.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps6.jpg) 

（2）右键点击“SQL查询”组件；选择“分区”；选择“哈希取余分区法”；选择新建好的分区（分区1）“确定”；填入“字段名称”（这里字段选择整型类型，确保数据唯一性选择主键）点击“确定”。

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps7.jpg)![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps8.jpg)![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps9.jpg)![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps10.jpg) 

（3）右键点击“数据库记录插入”组件；选择分区；选择“哈希取余分区法”；选择新建好的分区（分区1）“确定”；填入“字段名称”（这里字段选择整型类型，确保数据唯一性选择主键）点击“确定”。

 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps11.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps12.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps13.jpg)![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps14.jpg) 

 （4）完成后效果如下：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps15.jpg) 

（5）双击“SQL查询”组件，将之前的查询语句替换如下：

***\*MySQL到MySQL分区条件如下配置：\****

SELECT `fid`,`ftext`,`fpart` FROM `t1` where id % ${Internal.Step.Unique.Count} = ${Internal.Step.Unique.Number}

 ***\*MySQL到Oracle分区条件如下配置：\****

SELECT * FROM `area` WHERE `id`%${Internal.Step.Partition.Size} = ${Internal.Step.Partition.Number}

 ***\*Oracle到Oracle分区条件如下配置（mod函数）：\****

SELECT * FROM "AC61" WHERE MOD(id,${Internal.Step.Partition.Size}) = ${Internal.Step.Partition.Number}

***\*Oracle到\*******\*M\*******\*ysql分区条件如下配置（mod函数）：\****

SELECT * FROM "AC61" WHERE MOD("id",${Internal.Step.Partition.Size})  =

${Internal.Step.Partition.Number}

 （注意：ETL使用文档中这个参数写错了，慎用）

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps16.jpg) 

 （6）部署执行

 ![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\ksohtml3616\wps17.jpg)

#### **4.2.11.2** ETL全量数据同步

【注】社保业务做全量数据同步的时候，就是A-B的全量，只能连接备库10.216.3.12做全量

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps83.jpg) 

备库和主库是秒级同步，主库是业务库有大量的数据处理，如果在全量也在主库做的话会给主库造成巨大的压力，所有社保A-B做全量就是在源端数据库连接备库。

 做全量前需要做的：查看出站服务器状态，启动通道，在DSPnode安装目录下，进入tongDSP目录，找到对应CDC名字目录，查看是否生成offset.dat文件，该文件记录数据库SCN号

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps84.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps85.jpg) 

如果生成上图所示，并且出站服务器状态为下图所示：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps86.jpg) 

以上要求都满足，停止通道

【注】新建的通道做全量之前，先让通道运行大概是十分钟。然后在停止通道

 A-B的全量:

停止通道之后在，目标端的数据库，将整理好的删除语句在目标端执行，清除目标端的数据

清空表和碎片

TRUNCATE TABLE CSIACCOUNT.AB45 reuse storage;

TRUNCATE TABLE CSIACCOUNT.AC97 reuse storage;

TRUNCATE TABLE CSIACCOUNT.AC53 reuse storage;

释放表空间：

alter table CSIACCOUNT.AB45 deallocate UNUSED KEEP 0; 

alter table CSIACCOUNT.AC97 deallocate UNUSED KEEP 0; 

alter table CSIACCOUNT.AC53 deallocate UNUSED KEEP 0; 

 通过ETL管理端，部署服务器上，运行。

全量跑完了，在启动通道。

 A-B-C-D的全量：

A-B做全量，但是B后面存在C,C后面存在D，此时需要注意

1、A中的CDC之前的表除去了，现在又加上了，需要B后面的C和D不受到增量数据的影响，按照以下步骤处理：

a、停止A-B之间的通道，B-C之间的通道，C-D之间的通道

b、将B-C、C-D通道里面的CDC配置,里面关于A-B要做全量的表除去。

c、将B-C，C-D通道启动，

d、开始A-B的全量，此时A-B的通道是停止的。

e、A-B的全量做完了之后，启动A-B的通道

f、A-B的全量做完了，需要等待一天之后在开始做B-C的全量，目的是A-B的归档时间往后移，B-C的全量之前要停止A-B的，让B数据停止不产生增量数据

g、B-C的全量做完了，等待一天之后再开始做C-D的全量，C-D的全量之前要停止B-C的通道，让C的数据禁止。

【注】全量之前，清理目标端的表空间。

 做全量的逻辑

1、B-C全量之间关闭A-B的通道

2、做C-D的全量关闭B-C的通道

###  **4.2.12 数据泵全量数据数据同步**

数据泵主要使用场景：

C-D的数据全量同步

社保系统的：企业，机关，居民 

就业创业和劳动关系不用数据泵

#### **4.2.12.1** 使用前步骤

使用数据泵之前需要停止B-C 的相关通道。具体的通道定位详见8 通道的业务逻辑。

#### 4.2.12.2 通道停止之后

1、到省市回流库服务器中，进入到指定的导出路径

导出路径的查询

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps89.jpg) 

登录服务器进入该路径下

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps90.jpg) 

【注意】服务器用户是oracle，不能使用root

 

#### **4.2.12.3** 开始执行源端数据导出

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps91.jpg) 

 

机关和居民需要指定单表导出，企业的指定用户导出即可



【注意】该文件导出的数据文件只适用于oracle 19c，如果对方的数据库是oracle 11g的需要添加参数 version=11.2.0.1.0 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps93.jpg) 

文件的参数说明

-- directory=DIR_DP  DIR_DP 是路径的名称不是具体的路径名

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps94.jpg) 

-- umpfile=CSI6201_2402_19C  CSI6201_2402_19C 是命名规则，可以自行命名

 

企业全量数据

企业的指定用户导出即可

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps95.jpg) 

 

#### **4.2.12.4** 目标端数据导入

【注意】导入数据之前清理目标端的库数据

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps96.jpg)   

#### **4.2.12.5** C-D的数据全量数据泵使用的用户和表的查找

例如机关和居民需要全量的用户和表

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps97.jpg) 

通过这个两张表来查找需要全量用户和表

文件中的无主键不做，只做有主建的

#  5.日常巡检

## **5.1** DSP巡检

### **5.1.1 DSP管理中心巡检（每天）**

登录10.216.12.34服务器

进入目录 /opt/tongtech/TongDSP/manager/logs

tail  -f tail -f manager.log 查看日志是否有报错 

查看管理中心进程，磁盘空间使用情况，内存，cpu

登录10.216.12.33服务器 查看dsp管理中心mysql配置库运行情况，

查看配置库端口监听 3316

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps101.jpg) 

### **5.1.2 dsp节点巡检（每天）**

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps102.jpg) 

进入dsp节点管理页面，查看节点状态；登录该节点服务器，查看节点进程，磁盘空间使用情况，内存，cpu。

### **5.1.3 zookeeper集群巡检（每月）**

巡检周期：一个月一次

Zookeep集群ip：

10.216.12.33:2181,

10.216.12.34:2181,

10.216.12.38:2181,

10.216.12.39:2181,

10.216.12.40:2181

五个一集群 

进入zk安装目录下 使用./bin/zkCli.sh 进入zookeeper的cli界面，然后 ls /otter/channel

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps103.jpg) 

正常 

看看有没有数据，只需要执行一次 bin/zkCli.sh ，能正常进入zookeeper的cli界面，基本上就是正常的，退出zookeeper cli 节点的命令是quit， 他没有exit命令。 

### **5.1.4 Oracle出栈服务器巡检（每天）**

1、每天巡检公服库、社保库、生产同步库、省市回流库出栈服务器的状态Oracle出栈服务器的状态

1）分别登录下面四个数据库

10.216.3.37_XSTRMADMIN 公服库

10.216.3.42_XSTRMADMIN 生产同步库

10.216.3.19_XSTREAMADMIN 社保库

10.216.200.54_省市回流库_xstreamadmin  省市回流库

 2）执行入下操作语句，查询出栈服务器的状态

SELECT ACTION, SID, SERIAL#, PROCESS, PROGRAM AS PROCESS_NAME FROM GV$SESSION WHERE MODULE ='XStream' AND ACTION LIKE '%TD46 -%';

查询结果如下图所示，出现五个进程，则该出栈服务器状态正常，不许要做任何处理

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps104.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps105.jpg) 

图片中的java进程是通道的进程

 

3）使用下面语句，巡检出栈服务器的CAPTURED_TIMESTAMP（捕获时间）和APPLIED_TIMESTAMP（应用时间）

SELECT CAPTURE_NAME, ERROR_NUMBER, ERROR_MESSAGE, 

-- FIRST_SCN, START_SCN, CAPTURED_SCN, APPLIED_SCN,

(SELECT SCN_TO_TIMESTAMP(CAPTURED_SCN) FROM DUAL) CAPTURED_TIMESTAMP,

(SELECT SCN_TO_TIMESTAMP(APPLIED_SCN) FROM DUAL) APPLIED_TIMESTAMP,

STATUS FROM DBA_CAPTURE

查询结果中，CAPTURED_TIMESTAMP（捕获时间）和APPLIED_TIMESTAMP（应用时间）

捕获时间必须是当前北京时间，应用时间是最后一次产生增量入库的时间

如下图捕获时间和应用时间都接近北京时间，这个状态正常

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps106.jpg) 

如下图就是有问题了

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps107.jpg) 

其中的捕获时间有明显的延迟

至此出栈服务器的状态巡检完毕。

 **1.1.1** ***\*Mysql通道巡检\*******\*（每天）\****

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps108.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps109.jpg) 

通道45、通道34 大屏展示，点进去查看管道，

查看延迟时间、最后同步时间和最后位点时间是否是当前最新时间。（周六周日节假日可能会因为没有业务导致不会更新，工作日一定会更新）

 

通道66、67、68、71、72、96、98都是mysql数据库运维上面的步骤一样也是查看延迟时间、最后同步时间和最后位点时间是否是当前最新时间。

### **5.1.5 生产库和地市库巡检（半个月）**

巡检周期（半个月）

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps110.jpg) 

使用这个软件连接数据库

首先查询他的使用率

使用

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps111.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps112.jpg) 

通过sql语句新增表空间

目前是2024年，新增的表空间需要放在2024下

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps113.jpg) 

重点以当前文件为主，2023年以后逐渐减少使用，也需要关注

 

需要巡检的库：

生产同步库，省市回流库，交换库，所有地市库（18个）

生产同步库:  10.216.3.44（42也能连）

省市回流库:  10.216.200.54

交换库:    10.216.3.49

所有地方库

兰州市只回流社保：10.193.96.237:1521/ORCLPDB1  管理员：system/123456  用户名：sbj  密码：sbj123  --兰州市使用服务器信息：root/j4+C0vGTyg 对应对方内网：10.30.5.251导数据使用，远程之后带使用10.30.5.251链接内网Windows
scp -P 9002 root@10.192.66.42:/u01/dump/CSI6201* D:\DATA\  cmd 导数据文件
兰州市信息中心回流全业务：10.197.217.88:1521/hlora           管理员：system/lh781109 用户名：lzxxzx  密码：lzxxzx123   --兰州信息中心使用
酒泉市：   10.195.36.66:11521/orcl           用户名：jq_srhl     密码：jq_1234
甘肃矿区：10.192.194.141:1528/GS7000  用户名：gskq  密码：gskq123
兰州新区：10.192.194.141:1528/GS7100  用户名：lzxq   密码：lzxq123
金昌市：   10.192.194.141:1528/GS0300  用户名：jcs      密码：jcs123
嘉峪关市：10.192.194.141:1528/GS0200  用户名：jygs   密码：jygs123
平凉市：   10.194.15.135:1521/PLRSJSJHL 用户名：PLRSJSJHL 密码：ZDwwzq#2022    服务器信息：oracle/ZDwwzq#2022
白银市：   10.196.108.173:1521/orcl19c  管理员：system/oracle   用户名：bys  密码：bys123  服务器信息：root/gsbyrs@22
天水市：   10.192.194.142:1528/gs0500  用户名：tss  密码：tss123
武威市：   10.192.194.142:1528/gs0600  用户名：wws  密码：wws123
张掖市：   10.194.194.12:1501/orcl          管理员：system/Oracle_1234   用户名：zys  密码：zys123 服务器信息：root/Linux123@sy 端口1502
庆阳市：   10.192.194.143:1528/gs1000  用户名：qys  密码：qys123 
定西市：   10.192.194.143:1528/gs1100  用户名：dxs  密码：dxs123
陇南市：   10.192.194.143:1528/gs1200  用户名：lns  密码：lns123

甘南藏族自治州：   10.192.194.143:1528/gs3000  用户名：gns  密码：gns123

（废弃已记录）
酒泉市：   10.195.36.66:1521/orcl     用户名：jqs_rsj_sjhl   密码：inspur135  第二个用户：sys/inspur123 （旧库）
张掖市：   10.192.194.142:1528/gs0700  用户名：zys  密码：zys123（省端旧库）
兰州市：   10.193.96.236:1521/orcl   用户名：sjk  密码：sjk123（旧库）对应对方内网：10.30.5.251
scp -P 9002 root@10.192.66.42:/u01/dump/CSI6201* D:\DATA\
scp -P 9002 root@10.192.66.42:/u01/dump/CSI6201_2402_19C* D:\DATA\

创建DBA用户并授权：
select * from all_users;

create user jygs identified by jygs123;
GRANT DBA TO jygs;
GRANT CREATE VIEW TO  jygs;
GRANT CREATE TABLE TO jygs;
GRANT RESOURCE TO     jygs;
GRANT CONNECT TO      jygs;

select * from user_role_privs;

其中自建机房放入地市：兰州市（6201），兰州信息中心（6201），白银市，张掖市，平凉市，酒泉市这个六个是属于自建机房。  

## **5.2** 问题处理

### **5.2.1 Oracle出栈服务器如何恢复**

例如当出栈服务器的捕获时间有明显的延迟

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps115.jpg) 

其恢复的步骤

（1）关闭该出栈服务器的通道，例如：出栈服务器TD45 其对应的通道就是通道45

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps116.jpg) 

（2）通道关闭之后，停止oracle的出栈服务器：

BEGIN DBMS_XSTREAM_ADM.STOP_OUTBOUND(server_name => 'TD46',FORCE => TRUE);END; 

（3）查看出栈服务器的状态，看看是出栈服务器的进程是不是都关闭了

SELECT ACTION, SID, SERIAL#, PROCESS, PROGRAM AS PROCESS_NAME FROM GV$SESSION WHERE MODULE ='XStream' AND ACTION 

LIKE '%TD46 -%';

如下图说明出栈服务器关闭了

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps117.jpg) 

（4）启动出栈服务器

BEGIN  DBMS_XSTREAM_ADM.START_OUTBOUND(

 server_name => 'TD46');

END;

（5）查看出栈服务器的状态是不是四个

SELECT ACTION, SID, SERIAL#, PROCESS, PROGRAM AS PROCESS_NAME FROM GV$SESSION WHERE MODULE ='XStream' AND ACTION 

LIKE '%TD46 -%';

如下图的四个进程，则说明启动成功

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps118.jpg) 

（6）将之前的关闭的通道启动

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps119.jpg) 

（7）查看出栈服务器的状态，如果是五个状态 则去看这个出栈服务器的通道节点日志

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps120.jpg) 

其中java是通道进程

此时需要看这个出栈服务器的通道节点日志

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps121.jpg) 

查看通道下有数据交换日志刷新，则通道和出栈服务器状态正常。

日志一般存放位置：/opt/tongtech/TongDSP/node11/logs/select

如何查看那个通道是在那个服务器下面

通道一百零一:

LM_AG:AC03,AF15,CAF1,CC24,CC25,CC26,CC27,CC28,CC29,CC30,CC31,CC32,CCAE,CCAG,CCB1,CCB3,CEB1;LM_AG6207:BCC1,BCC2,BCC3,BCC4,BGC1,BGC2,BGC3,BGC4,BGC5,BGC6,CC75,CC99,CCB2,CCB4,CCC1,CCC2,CCC3,CCD1,CEA1,CED1,CED2,CED3,CED4,CEF1;LM_BI:AA12,AA71,AB98,AB99,AC03,AC04,AC06,AC98,AC99,AE46,AE47,AE61,AF15;LM_BI6207:CE01;LM_CG:AF15,DC3A,DC99;LM_CG6207:DB35,DC35,DC74;LM_CR:AA56,AF15,CC23,CC24,CC25,CC26,CC27,CF67,CF68,CF69,CF70;LM_CR6207:CD20,CD21,CD22,CD23,CD24,CD25,CD26;LM_CT:AF15,CB91,CB92,CC91,CD02;LM_CT6207:CB70;LM_EC:AF15,CZ03,CZ85,CZ86;LM_EF:AF15,DC62,DC64;LM_EL:AF15,BD13,BD19,CC50,cd03,cd04;LM_EL6207:CC18,CC19,CC20,CC31,CC32,CC33,CC35,CC36,CC37,CC38,CD01,DC82,DC83,DF01,DF02,DF03;LM_PM:AF15;LM_PM6207:CED5;LM_VE:AF15;LM_VE6207:CC70,CC71,CC73,CC81,CC82,CCE1;LM_VT:AA09,AA10,AA51,AF15,CF06,CF15,DF09,GA03,GA06,GA07,GB11,GB12,GB13,GB14,GB15,GC23,GC24,GC32,GC33,GC35,GC51,GC52,GC53,GC54,GC55,GC56,GC58,GC60,GC98,GC99,GE11;LM_VT6207:DF0Q,DF34,DF35;  --分流通道

通道一百：LM_AG:AC03,AF15,BCC1,BCC2,BCC3,BCC4,BGC1,BGC2,BGC3,BGC4,BGC5,BGC6,CAF1,CC24,CC25,CC26,CC27,CC28,CC29,CC30,CC31,CC32,CC75,CC99,CCAE,CCAG,CCB1,CCB2,CCB3,CCB4,CCC1,CCC2,CCC3,CCD1,CEA1,CEB1,CED1,CED2,CED3,CED4,CEF1;LM_BI:AA12,AA71,AB98,AB99,AC03,AC04,AC06,AC98,AC99,AE46,AE47,AE61,AF15,CE01;LM_CG:AF15,DB35,DC35,DC3A,DC74,DC99;LM_CR:AA56,AF15,CC23,CC24,CC25,CC26,CC27,CD20,CD21,CD22,CD23,CD24,CD25,CD26,CF67,CF68,CF69,CF70;LM_CT:AF15,CB70,CB91,CB92,CC91,CD02;LM_EC:AF15,CZ03,CZ85,CZ86;LM_EF:AF15,DC62,DC64;LM_EL:AF15,BD13,BD19,CC18,CC19,CC20,CC31,CC32,CC33,CC35,CC36,CC37,CC38,CC50,CD01,CD03,CD04,DC82,DC83,DF01,DF02,DF03;LM_PM:AF15,CED5;LM_VE:AF15,CC70,CC71,CC73,CC81,CC82,CCE1;LM_VT:AA09,AA10,AA51,AF15,CF06,CF15,DF09,DF0Q,DF34,DF35,GA03,GA06,GA07,GB11,GB12,GB13,GB14,GB15,GC23,GC24,GC32,GC33,GC35,GC51,GC52,GC53,GC54,GC55,GC56,GC58,GC60,GC98,GC99,GE11; --就业创业，生产同步库-省市回流库第三批回流表清单，158张表，其中有一张表不参与回流 LM_EL.CC52



通道九十九:EINP_BASESTORE:AB99,AC99;HRSS_BI:AB97,AB98,AC97,AC98;

通道九十一：LRM_LA6202:BB16,BB17,BB1D,BB1Y,BB2E,BB2W,BB3A,BB3F,BB3H,BB4A,BB4J,BB5A,BB5J,BB95,BB99,BE31,BE32,BE36,BE37,BE38,BE39,BE40,BE41,BE42,BE43,BE45,BE46,BE47,BE81,BF11,BF12;LRM_LR6202:BB3T,BB3R,BB3W,BB42,BB49,BB4F,BB61,BB83,BC90,BF60;LRM_LS6202:BB01,BB50,BB55,BB60,BB68,BB73,BB77,BB80,BB92,BB98,BE09,BE10,BE11,BE12,BE13,BE24,BF01,BF02,BF04,BF07,BB15,BB20,BB30,BB43,BB6A,BB6B,BB6C,BE17,BE18,BE20;LRM_LA6203:BB16,BB17,BB1D,BB1Y,BB2E,BB2W,BB3A,BB3F,BB3H,BB4A,BB4J,BB5A,BB5J,BB95,BB99,BE31,BE32,BE36,BE37,BE38,BE39,BE40,BE41,BE42,BE43,BE45,BE46,BE47,BE81,BF11,BF12;LRM_LR6203:BB3T,BB3R,BB3W,BB42,BB49,BB4F,BB61,BB83,BC90,BF60;LRM_LS6203:BB01,BB50,BB55,BB60,BB68,BB73,BB77,BB80,BB92,BB98,BE09,BE10,BE11,BE12,BE13,BE24,BF01,BF02,BF04,BF07,BB15,BB20,BB30,BB43,BB6A,BB6B,BB6C,BE17,BE18,BE20;

CDC在用：LRM_LA6204:BB16,BB17,BB1D,BB1Y,BB2E,BB2W,BB3A,BB3F,BB3H,BB4A,BB4J,BB5A,BB5J,BB95,BB99,BE31,BE32,BE36,BE37,BE38,BE39,BE40,BE41,BE42,BE43,BE45,BE46,BE47,BE81,BF11,BF12;LRM_LR6204:BB3T,BB3R,BB3W,BB42,BB49,BB4F,BB61,BB83,BC90,BF60;LRM_LS6204:BB01,BB50,BB55,BB60,BB68,BB73,BB77,BB80,BB92,BB98,BE09,BE10,BE11,BE12,BE13,BE24,BF01,BF02,BF04,BF07,BB15,BB20,BB30,BB43,BB6A,BB6B,BB6C,BE17,BE18,BE20;

通道九零十：LRM_LA:BB16,BB17,BB1D,BB1Y,BB2E,BB2W,BB3A,BB3F,BB3H,BB4A,BB4J,BB5A,BB5J,BB95,BB99,BE31,BE32,BE36,BE37,BE38,BE39,BE40,BE41,BE42,BE43,BE45,BE46,BE47,BE81,BF11,BF12;LRM_LR:BB3T,BB3R,BB3W,BB42,BB49,BB4F,BB61,BB83,BC90,BF60;LRM_LS:BB01,BB50,BB55,BB60,BB68,BB73,BB77,BB80,BB92,BB98,BE09,BE10,BE11,BE12,BE13,BE24,BF01,BF02,BF04,BF07,BB15,BB20,BB30,BB43,BB6A,BB6B,BB6C,BE17,BE18,BE20; --劳动关系，生产同步库-省市回流库

通道八十九：CSIACCOUNT:AA06,AA12,AA16,AAE1,AAE2,AB10,AB15,AB18EX,AB26A3,AB47,AB71,AC06,AC07,AC15,AC16,AC17,AC47,AC48,AC50A3,AC50A4,AC50A5,AC50EX,AC51A2,AC52,AC53A1,AC54,AC54A1,AC54A2,AC55,AC72,AC72A1,AC72A2,AC84,AC94,AC98,AC98A1,AC98A2,ACZ1,ACZ2,ACZ3,AE02,AE02A1,AE13,AE28,AE28A1,AE29,AE30,AE30A1,AE36A1,AE36A2,AE42AA,AE43A1,AE43A5,AE43A6,AE43A9,AE44F1,AE44F3,AE45A1,AE45A2,AE45A3,AE45A4,AE45A5,AE45A6,AE45A7,AE45A8,AE45A9,AE45AA,AE45AB,AE45AC,AE45AD,AE45B1,AE45B2,AE45B4,AE45B5,AE45B6,AE45B7,AE45B8,AE45B9,AE49A1,AE49A8,AE49A9,AE49B2,AE62A2,AE64,AE65,AE70,AE71; --城乡居民，生产同步库-省市回流库


通道八十八：CSIACCOUNT:AA16,AC47,ACZ2,AC15,AC16;CSIIDENTIFY:LC31; --城乡居民，业务库-生产同步库(新)20240111新增AC15,AC16变动

通道八十八：CSIACCOUNT:AA06,AA12,AA16,AAE1,AAE2,AB10,AB15,AB18EX,AB26A3,AB47,AB71,AC06,AC07,AC15,AC16,AC17,AC47,AC48,AC50A3,AC50A4,AC50A5,AC50EX,AC51A2,AC52,AC53A1,AC54,AC54A1,AC54A2,AC55,AC72,AC72A1,AC72A2,AC84,AC94,AC98,AC98A1,AC98A2,ACZ1,ACZ2,ACZ3,AE02,AE02A1,AE13,AE28,AE28A1,AE29,AE30,AE30A1,AE36A1,AE36A2,AE42AA,AE43A1,AE43A5,AE43A6,AE43A9,AE44F1,AE44F3,AE45A1,AE45A2,AE45A3,AE45A4,AE45A5,AE45A6,AE45A7,AE45A8,AE45A9,AE45AA,AE45AB,AE45AC,AE45AD,AE45B1,AE45B2,AE45B4,AE45B5,AE45B6,AE45B7,AE45B8,AE45B9,AE49A1,AE49A8,AE49A9,AE49B2,AE62A2,AE64,AE65,AE70,AE71; --城乡居民，业务库-生产同步库(旧)

通道八十七：LM_AG6201:CAF2,CBA1,CBF1,CBF4,CBF7,CBF8,CBF9,CBFA,CC74,CCA1,CCA2,CCA5,CCA6,CCAA,CCAB,CCAC,CCAD,CCAF,CCAH,CCAI,CCE1,CCE2,CCE3,CCE4,CCE5,CCE6,CCE7,CCF1,CCF4,CCF5,CEA2,CEA3,CED5,CED6,CED7;LM_BI6201:AB02,AC02,AE01,AE60,AE71,AE99,BE70,CCE3;LM_CG6201:DB30,DB32,DB34,DC30,DC31,DC32,DC33,DC34,DC60,DC75,DC76,DC81;LM_CR6201:CB20,CB21,CB22,CB30,CB32,CB33,CB34,CC20,CC21,CC22,CC37,CF71,CF72,CF73,CF74,CF75,CF76,CF77,CF78,CF79,CF80,CF81,CF82,CF83,CF84,CF85,CF86,EY01,EY02,EY03,EY04,EY05;LM_CT6201:CB71,CB72,CB78,CB79,CB7A,CB7C,CB7D,CB7E,CB7F,CB90,CB97,CB98,CC72,CC89,CC90,CC92,CC94,CC98,CCG1,CD01,CD03,CD90,CF01,CF02;LM_EC6201:CZ01,CZ02,CZ04,CZ05;LM_EF6201:DC50,DC51,DC61,DC63,DC70,DC71,DC73;LM_EL6201:BD04,BD05,BD06,BD07,BD08,BD09,BD11,BD12,BD14,BD16,BD17,BD18,CB19,CC02,CC03,CC11,CC12,CC13,CC14,CC17;LM_VE6201:CC51,CC52,CC53,CC54,CC55,CC56,CC57,CC58,CC59,CC60,CC62,CC63,CC64,CC65,CC66,CC67,CC69,CC93,CD65,CM60;LM_VT6201:AF01,AF03,AF04,AF05,AF06,AF07,AF08,AF09,AF10,AF11,AF12,CF05,CF13,CF14,CF16,CF17,CF18,CF19,CF20,CF21,CF22,DC01,DC02,DC05,DC06,DC07,DC08,DC09,DC1E,DF04,DF05,DF07,DF08,DF0C,DF0E,DF0H,DF0K,DF0M,DF0N,DF0P,DF10,DF11,DF12,DF20,DF21,DF22,DF23,DF24,DF25,DF26,DF27,DF28,DF29,DF30,DF31,DF32,DF33,GC20,GC22,GC30,GC31,GC34; --就业，省市回流-兰州信息中心6201

通道七十三：LM_AG6202:CAF2,CBA1,CBF1,CBF4,CBF7,CBF8,CBF9,CBFA,CC74,CCA1,CCA2,CCA5,CCA6,CCAA,CCAB,CCAC,CCAD,CCAF,CCAH,CCAI,CCE1,CCE2,CCE3,CCE4,CCE5,CCE6,CCE7,CCF1,CCF4,CCF5,CEA2,CEA3,CED5,CED6,CED7;LM_BI6202:AB02,AC02,AE01,AE60,AE71,AE99,BE70,CCE3;LM_CG6202:DB30,DB32,DB34,DC30,DC31,DC32,DC33,DC34,DC60,DC75,DC76,DC81;LM_CR6202:CB20,CB21,CB22,CB30,CB32,CB33,CB34,CC20,CC21,CC22,CC37,CF71,CF72,CF73,CF74,CF75,CF76,CF77,CF78,CF79,CF80,CF81,CF82,CF83,CF84,CF85,CF86,EY01,EY02,EY03,EY04,EY05;LM_CT6202:CB71,CB72,CB78,CB79,CB7A,CB7C,CB7D,CB7E,CB7F,CB90,CB97,CB98,CC72,CC89,CC90,CC92,CC94,CC98,CCG1,CD01,CD03,CD90,CF01,CF02;LM_EC6202:CZ01,CZ02,CZ04,CZ05;LM_EF6202:DC50,DC51,DC61,DC63,DC70,DC71,DC73;LM_EL6202:BD04,BD05,BD06,BD07,BD08,BD09,BD11,BD12,BD14,BD16,BD17,BD18,CB19,CC02,CC03,CC11,CC12,CC13,CC14,CC17;LM_VE6202:CC51,CC52,CC53,CC54,CC55,CC56,CC57,CC58,CC59,CC60,CC62,CC63,CC64,CC65,CC66,CC67,CC69,CC93,CD65,CM60;LM_VT6202:AF01,AF03,AF04,AF05,AF06,AF07,AF08,AF09,AF10,AF11,AF12,CF05,CF13,CF14,CF16,CF17,CF18,CF19,CF20,CF21,CF22,DC01,DC02,DC05,DC06,DC07,DC08,DC09,DC1E,DF04,DF05,DF07,DF08,DF0C,DF0E,DF0H,DF0K,DF0M,DF0N,DF0P,DF10,DF11,DF12,DF20,DF21,DF22,DF23,DF24,DF25,DF26,DF27,DF28,DF29,DF30,DF31,DF32,DF33,GC20,GC22,GC30,GC31,GC34; --就业，省市回流-嘉峪关6202

通道七十：LM_EC:CZ01,CZ02,CZ04,CZ05;LM_EF:DC50,DC51,DC61,DC63,DC70,DC71,DC73;LM_EL:BD04,BD05,BD06,BD07,BD08,BD09,BD11,BD12,BD14,BD16,BD17,BD18,CB19,CC02,CC03,CC11,CC12,CC13,CC14,CC17;LM_VE:CC51,CC52,CC53,CC54,CC55,CC56,CC57,CC58,CC59,CC60,CC62,CC63,CC64,CC65,CC66,CC67,CC69,CC93,CD65,CM60;LM_VT:AF03,AF04,AF05,AF06,AF07,AF08,AF09,AF10,AF11,AF12,CF05,CF13,CF14,CF16,CF17,CF18,CF19,CF20,CF21,CF22,DC01,DC02,DC05,DC06,DC07,DC08,DC09,DC1E,DF04,DF05,DF07,DF08,DF0C,DF0E,DF0H,DF0K,DF0M,DF0N,DF0P,DF10,DF11,DF12,DF20,DF21,DF22,DF23,DF24,DF25,DF26,DF27,DF28,DF29,DF30,DF31,DF32,DF33,GC20,GC22,GC30,GC31,GC34; --就业，生产同步库-省市回流库2
CDC删除记录：LM_VT:AF01（AAF039为CLOB大字段，暂时去掉）

通道六十九：LM_AG:CAF2,CBA1,CBF1,CBF4,CBF7,CBF8,CBF9,CBFA,CC74,CCA1,CCA2,CCA5,CCA6,CCAA,CCAB,CCAC,CCAD,CCAF,CCAH,CCAI,CCE1,CCE2,CCE3,CCE4,CCE5,CCE6,CCE7,CCF1,CCF4,CCF5,CEA2,CEA3,CED5,CED6,CED7;LM_BI:AB02,AC02,AE01,AE60,AE71,AE99,BE70,CCE3;LM_CG:DB30,DB32,DB34,DC30,DC31,DC32,DC33,DC34,DC60,DC75,DC76,DC81;LM_CR:CB20,CB21,CB22,CB30,CB32,CB33,CB34,CC20,CC21,CC22,CC37,CF71,CF72,CF73,CF74,CF75,CF76,CF77,CF78,CF79,CF80,CF81,CF82,CF83,CF84,CF85,CF86,EY01,EY02,EY03,EY04,EY05;LM_CT:CB71,CB72,CB78,CB79,CB7A,CB7C,CB7D,CB7E,CB7F,CB90,CB97,CB98,CC72,CC89,CC90,CC92,CC94,CC98,CCG1,CD01,CD03,CD90,CF01,CF02; --就业，生产同步库-省市回流库1

通道六十五：EINP_BASICINFO6201:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_FINANCIAL6201:AD52,AD53,AD64;EINP_TREATMENT6201:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6201:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6201:AD50,AD51,AD66;EINP_SETTLE6201:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（兰州信息中心6201）
CDC删除记录：EINP_RISKCONTROL6201:ZE02,ZE05;

通道四十九：CSIACCOUNT:AC53;CSIFINANCE:AD01A4;CSIRELATION:AB01EX,AB01HY,AC01EX;CSITREATMENT:AC73I1,AC75A1,AC78A1,AC78A2,AC84,AC93EX,AC98A1,IC10EX,IC10I1,IC10I4,KB01,LC07L1,LC07L2,LC08L1,LC08L2,LC08L3,LC29L1,LC30,LC96;CSIACCOUNT6201:AB45,AC97,AA16,AC47,ACZ2;CSIANNUITY6201:ID01,ID01I1,ID08,ID09,ID12,ID14,ID16,ID19,ID40,ID42,ID43,ID55,ID56,ID66,ID76;CSIFINANCE6201:AD02;CSIRELATION6201:AB03,AB66,AB67,AB68,AC03,IC69,JC87;CSITREATMENT6201:AC55,AC56,AC59,AC71,AC72,AC74,AC75,AC77,AC78,AC80,AC81,AC93,AC98,AC98A3,AF12,AF13,IC10I3,JC10,JC11,JC21,JC22,LA01,LA06,LA62,LC01,LC03,LC04,LC05,LC06,LC07,LC08,LC28,LC29,LC31,LC65,SE01; --机关、城乡居民回流只包含主键表CDC配置，Xstream全部配置，兰州6201

通道四十八：CSITREATMENT:AC55,AC56,AC59,AC71,AC72,AC74,AC75,AC77,AC78,AC80,AC81,AC93,AC98,AC98A3,AF12,AF13,IC10I3,JC10,JC11,JC21,JC22,LA01,LA06,LA62,LC01,LC03,LC04,LC05,LC06,LC07,LC08,LC28,LC29,LC31,LC65,SE01,AC73I1,AC75A1,AC78A1,AC78A2,AC84,AC93EX,AC98A1,IC10EX,IC10I1,IC10I4,KB01,LC07L1,LC07L2,LC08L1,LC08L2,LC08L3,LC29L1,LC30,LC96; --目前在用

通道四十八：CSITREATMENT:AC55,AC56,AC59,AC71,AC72,AC74,AC75,AC77,AC78,AC80,AC81,AC93,AC98,AC98A3,AF12,AF13,IC10I3,JC10,JC11,JC21,JC22,LA01,LA06,LA62,LC01,LC03,LC03L1,LC04,LC05,LC06,LC07,LC08,LC28,LC29,LC31,LC65,LF01,SE01,AC73I1,AC75A1,AC78A1,AC78A2,AC84,AC93EX,AC98A1,IC10EX,IC10I1,IC10I4,KB01,LC07L1,LC07L2,LC08L1,LC08L2,LC08L3,LC29L1,LC30,LC96,LC98; --机关保业务，生产同步库-省市回流库_最初CDC配置

通道四十七：CSIACCOUNT:AB45,AC97,AC53;CSIANNUITY:ID01,ID01I1,ID08,ID09,ID12,ID14,ID16,ID19,ID40,ID42,ID43,ID55,ID56,ID66,ID76;CSIFINANCE:AD02,AD01A4;CSIRELATION:AB03,AB66,AB67,AB68,AC03,IC69,JC87,AB01EX,AB01HY,AC01EX; --目前在用

通道四十七：CSIACCOUNT:AB19,AB26,AB45,AC51A1,AC53,AC97,AD21;CSIANNUITY:ID01,ID01I1,ID08,ID09,ID12,ID14,ID16,ID19,ID40,ID42,ID43,ID55,ID56,ID66,ID76;CSIFINANCE:AD01,AD01A1,AD01A4,AD02,AD03,AD04,AD11,AD26,AD64A2;CSIPARAMETER:AF07;CSIRELATION:AB01EX,AB01HY,AB03,AB04,AB66,AB67,AB68,AB69,AB70,AC01EX,AC03,AC10,AC11,IC58,IC60,IC69,JC87;CSITRANSFER:AFT1; --机关保业务，生产同步库-省市回流库_最初CDC配置

通道四十六：CSIACCOUNT:AB45,AC97,AC53;CSIANNUITY:ID01,ID01I1,ID08,ID09,ID12,ID14,ID16,ID19,ID40,ID42,ID43,ID55,ID56,ID66,ID76;CSIFINANCE:AD02,AD01A4;CSIRELATION:AB03,AB66,AB67,AB68,AC03,IC69,JC87,AB01EX,AB01HY,AC01EX;CSITREATMENT:AC55,AC56,AC59,AC71,AC72,AC74,AC75,AC77,AC78,AC80,AC81,AC93,AC98,AC98A3,AF12,AF13,IC10I3,JC10,JC11,JC21,JC22,LA01,LA06,LC01,LC03,LC04,LC05,LC06,LC07,LC08,LC28,LC29,LC31,LC65,SE01,AC73I1,AC75A1,AC78A1,AC78A2,AC84,AC93EX,AC98A1,IC10EX,IC10I1,IC10I4,KB01,LC07L1,LC07L2,LC08L1,LC08L2,LC08L3,LC29L1,LC30,LC96; --目前在用 
CDC删除记录：LA62 已修改表机构，暂时已去除

通道四十六：CSIACCOUNT:AB19,AB26,AB45,AC51A1,AC53,AC97,AD21;CSIANNUITY:ID01,ID01I1,ID08,ID09,ID12,ID14,ID16,ID19,ID40,ID42,ID43,ID55,ID56,ID66,ID76;CSIFINANCE:AD01,AD01A1,AD01A4,AD02,AD03,AD04,AD11,AD26,AD64A2;CSIPARAMETER:AF07;CSIRELATION:AB01EX,AB01HY,AB03,AB04,AB66,AB67,AB68,AB69,AB70,AC01EX,AC03,AC10,AC11,IC58,IC60,IC69,JC87;CSITRANSFER:AFT1;CSITREATMENT:AC55,AC56,AC59,AC71,AC72,AC73I1,AC74,AC75,AC75A1,AC77,AC78,AC78A1,AC78A2,AC80,AC81,AC84,AC93,AC93EX,AC98,AC98A1,AC98A3,AF12,AF13,IC10EX,IC10I1,IC10I3,IC10I4,JC10,JC11,JC21,JC22,KB01,LA01,LA06,LA62,LC01,LC03,LC03L1,LC04,LC05,LC06,LC07,LC07L1,LC07L2,LC08,LC08L1,LC08L2,LC08L3,LC28,LC29,LC29L1,LC30,LC31,LC65,LC96,LC98,LF01,SE01;   -- 机关保业务系统CSI_最初CDC配置

通道四十五：就业创业Mysql业务库-生产同步库大屏展示

通道四十四：EINP_BASICINFO6230:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6230:ZE02,ZE05;EINP_FINANCIAL6230:AD52,AD53,AD64;EINP_TREATMENT6230:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6230:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6230:AD50,AD51,AD66;EINP_SETTLE6230:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（甘南藏族自治州6230）

通道四十三：EINP_BASICINFO6212:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6212:ZE02,ZE05;EINP_FINANCIAL6212:AD52,AD53,AD64;EINP_TREATMENT6212:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6212:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6212:AD50,AD51,AD66;EINP_SETTLE6212:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（陇南6212）

通道四十二：EINP_BASICINFO6211:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6211:ZE02,ZE05;EINP_FINANCIAL6211:AD52,AD53,AD64;EINP_TREATMENT6211:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6211:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6211:AD50,AD51,AD66;EINP_SETTLE6211:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（定西6211）

通道四十一：EINP_BASICINFO6210:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6210:ZE02,ZE05;EINP_FINANCIAL6210:AD52,AD53,AD64;EINP_TREATMENT6210:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6210:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6210:AD50,AD51,AD66;EINP_SETTLE6210:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（庆阳6210）

通道四十：EINP_BASICINFO6207:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6207:ZE02,ZE05;EINP_FINANCIAL6207:AD52,AD53,AD64;EINP_TREATMENT6207:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6207:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6207:AD50,AD51,AD66;EINP_SETTLE6207:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（张掖6207）

通道三十九：EINP_BASICINFO6206:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6206:ZE02,ZE05;EINP_FINANCIAL6206:AD52,AD53,AD64;EINP_TREATMENT6206:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6206:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6206:AD50,AD51,AD66;EINP_SETTLE6206:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（武威6206）

通道三十八：EINP_BASICINFO6205:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6205:ZE02,ZE05;EINP_FINANCIAL6205:AD52,AD53,AD64;EINP_TREATMENT6205:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6205:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6205:AD50,AD51,AD66;EINP_SETTLE6205:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（天水6205）

通道三十七：HRSS_BI:AB98,AC98;EINP_BASESTORE:AB99,AC99; --社保库-就业创业Mysql业务库

通道三十六：GFADMIN:SYSORG,SYSUSER,WORKDAY_CONFIG; --公服正式库-劳动关系Mysql业务库

通道三十五：HRSS_BI:AB98;EINP_BASESTORE:AB99,AC99; --社保库-劳动关系Mysql业务库

通道三十四：劳动关系Mysql业务库-生产同步库大屏展示

通道三十三：EINP_BASICINFO6204:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6204:ZE02,ZE05;EINP_FINANCIAL6204:AD52,AD53,AD64;EINP_TREATMENT6204:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6204:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6204:AD50,AD51,AD66;EINP_SETTLE6204:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（白银6204）

通道三十二：EINP_BASICINFO6208:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6208:ZE02,ZE05;EINP_FINANCIAL6208:AD52,AD53,AD64;EINP_TREATMENT6208:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6208:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6208:AD50,AD51,AD66;EINP_SETTLE6208:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（平凉6208）
备注：EINP_PARAMETER6208:AA01,AA02,AA10,AF01,ZE80;该用户下所有表没有AAA431和AAB359字段，不满足分流条件。

通道三十一：EINP_BASICINFO6202:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6202:ZE02,ZE05;EINP_FINANCIAL6202:AD52,AD53,AD64;EINP_TREATMENT6202:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6202:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6202:AD50,AD51,AD66;EINP_SETTLE6202:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（嘉峪关6202）
备注：EINP_PARAMETER6202:AA01,AA02,AA10,AF01,ZE80;该用户下所有表没有AAA431和AAB359字段，不满足分流条件。

通道三十：EINP_BASICINFO6203:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6203:ZE02,ZE05;EINP_FINANCIAL6203:AD52,AD53,AD64;EINP_TREATMENT6203:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6203:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6203:AD50,AD51,AD66;EINP_SETTLE6203:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（金昌6203）
备注：EINP_PARAMETER6203:AA01,AA02,AA10,AF01,ZE80;该用户下所有表没有AAA431和AAB359字段，不满足分流条件。

通道二十九：EINP_BASICINFO6271:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6271:ZE02,ZE05;EINP_FINANCIAL6271:AD52,AD53,AD64;EINP_TREATMENT6271:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6271:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6271:AD50,AD51,AD66;EINP_SETTLE6271:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（兰州新区6271）
备注：EINP_PARAMETER6271:AA01,AA02,AA10,AF01,ZE80;该用户下所有表没有AAA431和AAB359字段，不满足分流条件。

通道二十八：EINP_BASICINFO6270:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6270:ZE02,ZE05;EINP_FINANCIAL6270:AD52,AD53,AD64;EINP_TREATMENT6270:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6270:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6270:AD50,AD51,AD66;EINP_SETTLE6270:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（甘肃矿区6270）
备注：EINP_PARAMETER6270:AA01,AA02,AA10,AF01,ZE80;该用户下所有表没有AAA431和AAB359字段，不满足分流条件。

通道二十七：EINP_COLLECTION:AB07,AC95,AC96; --省市回流，由通道四拆分

通道二十六：EINP_COLLECTION:AC43; --省市回流，由通道四拆分

通道二十五：EINP_BASICINFO:AC04,AC35;EINP_TREATMENT:AC82,AC83; --省市回流，由通道五拆分

通道二十四：EINP_COLLECTION:AC08; --省市回流，由通道五拆分

通道二十三：EINP_BASICINFO6209:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6209:ZE02,ZE05;EINP_FINANCIAL6209:AD52,AD53,AD64;EINP_TREATMENT6209:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6209:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6209:AD50,AD51,AD66;EINP_SETTLE6209:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（酒泉6209）
备注：EINP_PARAMETER6209:AA01,AA02,AA10,AF01,ZE80;该用户下所有表没有AAA431和AAB359字段，不满足分流条件。

通道二十二：EINP_BASICINFO6201:AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC02,AE06,AE07,AC04,AC35;EINP_RISKCONTROL6201:ZE02,ZE05;EINP_FINANCIAL6201:AD52,AD53,AD64;EINP_TREATMENT6201:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13,AC82,AC83;EINP_COLLECTION6201:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14,AB07,AC43,AC08,AC95,AC96;EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99;EINP_FUNDFINANCE6201:AD50,AD51,AD66;EINP_SETTLE6201:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;EINP_BASICINFO:AB01,AC01; --地市回流社保（兰州6201）
备注：EINP_PARAMETER6201:AA01,AA02,AA10,AF01,ZE80;该用户下所有表没有AAA431和AAB359字段，不满足分流条件。

通道二十一：EINP_BASICINFO:AB01,AB02,AC01;EINP_COLLECTION:AB07; --交换库需求

通道十九：EINP_RISKCONTROL:ZE01,ZE03,ZE04,ZE06; --生产同步库-回流，含有CLOB,BLOB字段，使用Logminer抽取方式，全部表没有AAB359字段，AAA431字段值都不符合分流条件！！！

通道十八：EINP_RISKCONTROL:ZE01,ZE03,ZE04,ZE06; --社保-生产同步库，含有CLOB,BLOB字段，使用Logminer抽取方式

通道十七：HRSS_BI:AC98,AC97,AB98,AB97; --社保生产HRSS_BI用户到测试劳动、就业HRSS_BI用户

通道十六：EINP_COLLECTION:AC43; --交换库需求

通道十五：EINP_COLLECTION:AC96; --社保库

通道十四：EINP_COLLECTION:AC95; --社保库

通道十三：EINP_COLLECTION:AC08; --社保库

通道十二：EINP_COLLECTION:AC43; --社保库

通道十一：EINP_COLLECTION:AB07;EINP_BASICINFO:AC04,AC35;EINP_TREATMENT:AC82,AC83;--社保其他上亿表

通道九：EINP_BASICINFO:AB01,AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC01,AC02,AE06,AE07;EINP_RISKCONTROL:ZE02,ZE05;EINP_FINANCIAL:AD52,AD53,AD64;HRSS_BI:AB97,AB98,AC97,AC98,AE95,AE96;EINP_TREATMENT:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13;--社保EINP用户

通道九：EINP_BASICINFO:AB01,AB02,AB32,AB36,AC05,AC20,AE01,AE03,AE32,AE36,AC01,AC02,AE06,AE07;EINP_RISKCONTROL:ZE02,ZE05;EINP_FINANCIAL:AD52,AD53,AD64;HRSS_BI:AB97,AB98,AC97,AC98,AE95,AE96;EINP_TREATMENT:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13;
通道九删除流程表记录：EINP_TREATMENT:LRR;EINP_BASICINFO:MLOG$_AB01,MLOG$_AB02,MLOG$_AC01,MLOG$_AC02,RUPD$_AB01,RUPD$_AB02,RUPD$_AC01,RUPD$_AC02,TMP_Y_MLOG$_AB01;

通道八：EINP_COLLECTION:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14;EINP_BASESTORE:AB99,AC99,AE97,AE98;EINP_FUNDFINANCE:AD50,AD51,AD66;EINP_SETTLE:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;--社保EINP用户
通道八DSP删除流程表记录：EINP_COLLECTION:AC50_BAK;EINP_BASESTORE:AE99;
通道八CDC删除流程表记录：EINP_COLLECTION:AC50_BAK;EINP_BASESTORE:AE99;

通道七：GFADMIN:AE02,ITEM_INFO,FLOW_HI_TASK,ITEM_LEVEL,SYSUSER,SYSORG;--大屏展示

通道六-Mysql：dwlesb:zs02,zs03,zs04,zs15;--地纬日志信息

通道五：EINP_BASICINFO:AB01,AB02,AB32,AB36,AC01,AC02,AC05,AC20,AE01,AE03,AE06,AE07,AE32,AE36;EINP_RISKCONTROL:ZE02,ZE05;EINP_FINANCIAL:AD52,AD53,AD64;EINP_TREATMENT:AC13,AC14,AC18,AC19,AC57,AC58,AC60,AC61,AC62,AC63,AC64,AC65,AC70,AC76,AC79,AC90,IA01,IC08,IC10,IC12,IC13;--省市回流
通道五删除流程表记录：EINP_TREATMENT:LRR;
备注：EINP_RISKCONTROL:ZE02,ZE05表没有AAB359字段，AAA431字段值都不符合分流条件。EINP_BASICINFO:AB01,AC01,AE01,AE06,AE07,AE32表没有AAB359字段,其中AB01,AC01单独给各地市回流,其他表采用AAA431分流。

通道四：EINP_COLLECTION:AE38,AE31,AC50,AC51,AB18,AB19,AE22,AB14;EINP_BASESTORE:AB99,AC99,AE97,AE98;EINP_FUNDFINANCE:AD50,AD51,AD66;EINP_SETTLE:IC65,IC66,IC67,IC68,IC70,IC71,IC72,IC73,IC74,IC75,IC76,IC77,IC78,IC87,IC88,IC89,IC90,IC91,IC92,IC95,IC96,IC97;EINP_PARAMETER:AA01,AA02,AA10,AF01,ZE80;--省市回流
通道四删除流程表记录：EINP_PARAMETER:AA01,AA02,AA10,AF01(已删除),ZE80,该用户下所有表没有AAA431和AAB359字段,全量给各地市回流；EINP_BASESTORE:AB99,AC99,AE97,AE98,AE99(日志表不全量，已删除),其他所有表没有AAB359字段,全量给各地市回流。


通道三：GFADMIN:AA10,AAZ002_SITUATIONCODE,AD20,AD21,AREA_CODE,DATA_SCHEDULED_TASK_CONFIG,DATA_STATISTICS_RESULT,DEMO_DATA,DN_TASK_CACHE,EXT_INTERFACE,EXT_INTERFACE_FILE,EXT_INTERFACE_PARAMS,FLOW_HI_TASK_MONITOR,FLOW_RU_TASK,FLOW_RU_TASK_MONITOR,FLOW_TASK,FLOW_TASK_MONITOR,GGFW_PORTAL_SERVICES,HASB4POSTUSERINFO,ITEM_CONFIG,ITEM_INFO_MONITOR,ITEM_MO,ITEM_SITUATION,MSC_CHANNEL,MSC_LOG,MSC_TEMPLATE,MSG,MSG_MODEL,MSG_STATUS,MY_COLLECTION,OUT_FILE_CONFIG,OUT_FILE_INFO,OUT_FILE_OBS,OUT_FILE_RELATION,REPORT_CONFIG,SYSAPI,SYSCLIENT,SYSCLIENTAPI,SYSCLIENTFUNCTION,SYSCLIENTITEM,SYSFUNCTION,SYSFUNCTIONAPI,SYSITEMAPI,SYSPATHMG,SYSROLE,SYSROLEFUNCTION,SYS_CONTROL,SYS_CONTROL_ITEM,SYS_CONTROL_ITEM_BJPZ,SYS_CONTROL_ITEM_BTN,SYS_CONTROL_ITEM_BTN_PARAM,SYS_CONTROL_ITEM_REASON,SYS_CONTROL_ITEM_URL,SYS_CONTROL_ITEM_WARNING,SYS_POST,SYS_POST_ITEM,SYS_USER_LOGIN_RECORD,SYS_USER_POST,TYRZ_LOGIN_LOG,TYRZ_PERSON_USER,TYRZ_UNIT_USER,WORKDAY_CONFIG;--公服生产
通道三删除流程表记录：GFADMIN:SYSUSERROLE,UP_PRO_BASE,GGFW_PORTAL_SERVICES(已删除可创建20230606)
通道三包含CLOB,BLOB字段：GFADMIN:NOTICE_INFO,MSG_DETAIL; --暂未创建

通道二：CSIFINANCE:AA16,AD01,AD01A1,AD01A4,AD02,AD03,AD04,AD11,AD26,AD57,AD58,AD59,AD64A1,AD64A2,AD76,AE02,AE02A1,AE02A2,AE02A9,AE02E5,AE02E6,AE44C3,AE61A2,AE61A3,AE61A4,AE61A5,AE61A7,AE62A1,AE62A2,AE62A3,AE62A4,AE70,AE71;CSIPARAMETER:AA09,AA14,AA17,AA19,AA62,AE02A2,AE02A4,AE02A9,AF07;CSITREATMENT:AA16,AA40,AA40A1,AA40A2,AA40I1,AC04Z1,AC13Z1,AC14Z1,AC18Z1,AC19A1,AC19Z1,AC21,AC55,AC55Z1,AC57Z1,AC58Z1,AC60Z1,AC61A3,AC61Z1,AC62Z1,AC63Z1,AC64EX,AC64Z1,AC65Z1,AC66,AC70Z1,AC71,AC72,AC72Z1,AC73I1,AC74,AC75,AC75A1,AC76Z1,AC77,AC78,AC78A1,AC78A2,AC78A3,AC79Z1,AC80,AC81,AC82Z1,AC84,AC98,AC98A1,AC98A2,AC98A3,AE02,AE02A1,AE02A2,AE02A4,AE02A9,AE02E5,AE02E6,AE17,AE17L1,AE18,AE30,AE33,AE34,AE42B1,AE51,AE52,AE70,AE71,AF12,AF13,AF57,IA18,IA19,IC03,IC07,IC08Z1,IC10EX,IC10I1,IC10I1Z1,IC10I2Z1,IC10I3,IC10I4,IC10I5,IC10Z1,IC12Z1,IC13Z1,IC20,ID19,ID75,ID76,IE03,IE04,IE05,IE07,IE07A1,IE08,JA01,JA02,JA03,JA05,JA06,JC05,JC10,JC18,JC21,JC22,JC34,JC45,KA20,KA21,KB01,KB01A1,KF4B,LA01,LA02,LA06,LA08,LA13,LA61,LA62,LA63,LA65,LA68,LC01,LC02,LC03,LC03L1,LC04,LC05,LC05L1,LC05L2,LC06,LC07,LC07L1,LC07L2,LC08,LC08L1,LC08L2,LC08L3,LC08L4,LC09,LC10,LC17,LC17L1,LC27,LC28,LC28L1,LC29,LC29L1,LC30,LC31,LC32,LC42,LC43,LC44,LC45,LC46,LC64,LC65,LC67,LC96,LC97,LC98,LF01,LF02,LF03,LF05,LF06,SE01;--社保CSI用户
通道二删除流程表记录：CSITREATMENT:AC56,AC59,AE02A3;CSIFINANCE:AE02A3;CSIPARAMETER:AE02A3;
Logminer通道二：CSIFINANCE:AE02A3,AE02A7,AE72,AE50D2,AE02E1,AE50D4Z1,AE50,AE50D4,AE50D3,AE50A8,AE50A1,AE51A1,AE50D1;CSIPARAMETER:AE02A3,AE02,AE02A7,AE02A1;CSITREATMENT:AE02A3,AE50Z1,AE50Z2,AE51A1,JC01,JC02,JC03,JC04,AE50I1,AE02A5,AE02A7,AE02E1,AE50,AE50A1,AE50A2,AE50AD,LC99,LC99L1,AE50Z5,AE72,AE50A5,AE50AC; --LOB字段，暂未创建



通道一：CSIACCOUNT:AA12,AA16,AB14Z1,AB15,AB19,AB26,AB45,AC04Z1,AC07,AC08Z1,AC16,AC17,AC43Z1,AC47,AC50A4,AC50Z1,AC51A1,AC51Z1,AC52,AC53,AC53Z1,AC54,AC55,AC72,AC72A1,AC72A2,AC84,AC95Z1,AC96Z1,ACZ1,ACZ2,ACZ3,ACZ4,AD21,AE02,AE02A2,AE02A9,AE02E5,AE02E6,AE22Z1,AE30,AE31Z1,AE36A1,AE36A2,AE38Z1,AE45A7,AE45A9,AE45B1,AE45B2,AE45B4,AE45B5,AE45B8,AE45C1,AE51,AE52,AE70,AE71,IC10I1;CSIRELATION:AA16,AA40,AA40A1,AA40A2,AA40I1,AB01EX,AB03,AB04,AB66,AB67,AB68,AB69,AB70,AC01A1,AC01A2,AC01EX,AC03,AC04Z1,AC10,AC11,AC51A2,AC59,AC71,AC73I1,AC74,AC75,AC75A1,AC77,AC78,AC78A1,AC78A2,AC81,AE02,AE02A1,AE02A2,AE02A9,AE02E5,AE02E6,AE35,AE40A1,AE41A1,AE41A2,AE41A3,AE41A4,AE41A6,AE41EX,AE42A1,AE42A2,AE42A3,AE42A4,AE42A6,AE42A7,AE42A8,AE42A9,AE42B1,AE42EX,AE42L1,AE43A2,AE43A3,AE44A1,AE44A2,AE44A3,AE44A4,AE44A5,AE44A6,AE44A7,AE44A8,AE44A9,AE44B1,AE44B2,AE44B3,AE44B4,AE44B5,AE44C1,AE44C3,AE44C4,AE44C5,AE44C6,AE44C7,AE44C8,AE44C9,AE44D1,AE44D2,AE44D3,AE44E2,AE44E3,AE44F2,AE44F4,AE44F5,AE44F6,AE47A1,AE47A2,AE47A3,AE47A4,AE51,AE70,AE71,AF02,AF08,AF12,AF13,IC03,IC07,IC09,IC10I1,IC10I2,IC10I3,IC58,IC60,IC65Z1,IC66Z1,IC67Z1,IC68Z1,IC69,IC70Z1,IC71Z1,IC72Z1,IC73Z1,IC74Z1,IC75Z1,IC76Z1,IC77Z1,IC78Z1,IC89Z1,IC90Z1,IC91Z1,IC92Z1,IC95Z1,IC96Z1,IC97Z1,IE02,IE03,IE04,JC10,JC21,JC22,JC34,JC45,JC87,JC88,JC90,LA63,LC01,LC02,LC03,LC04,LC05L1,LC07L1,LC08L1,LC30,LC31,LF01,SE01;CSITRANSFER:AE02,AE02A2,AE02A4,AE02A9,AE82,AE85PT,AF01,AFT1;--社保CSI用户
通道一删除流程表记录：CSIRELATION:AE42A5,AE02A3;CSIACCOUNT:AE02A3;CSITRANSFER:AE02A3;
Logminer通道一：CSIACCOUNT:AE50Z4,AE51A1,AE5
1A2,AE72,AE50A9,AE50AG,AE50F1,AE50A4,AE50A6,AE50A7,AE50,AE50A2,AE50A3,AE02A7,AE02E1,AE02A3;CSIRELATION:AE02A7,AE02E1,AE50,AE50B1,AE50Z1,AE72,AE51A1,AE50A1,AE50AB,AE02A3;CSITRANSFER:AE78,AE83,AE77,AE02A3; --LOB字段，暂未创建

一台服务器可以部署多个dsp node节点，但是一个node节点最多运行4-5个通道。
33服务器node1：通道四，通道十二，通道十四，通道十七，通道十九，通道二十七  
34服务器node2：通道五，通道十一，通道十三，通道十五                        
38服务器node3：通道一，通道三，通道七，通道八                              
39服务器node4：通道二，通道六，通道九，通道十六，通道十八，通道二十一、五十三（后加机关保天水地市）     
33服务器node5：通道二十四，通道二十五，通道二十六                          
34服务器node6：通道二十二、通道二十三、通道二十八、通道二十九                 
38服务器node7：通道三十、通道三十一、通道三十二、通道三十三               
34服务器node8：通道三十四、通道三十五、通道三十六、通道三十七、通道四十五  
39服务器node9：通道三十八、通道三十九、通道四十、通道四十一                
40服务器node10：通道四十二、通道四十三、通道四十四、通道四十六             
40服务器node11：通道四十七、通道四十八、通道四十九、通道五十、通道五十一   
40服务器node12：通道五十二、通道五十三、通道五十四、通道五十五、通道五十六 
38服务器node13：通道五十七、通道五十八、通道五十九、通道六十、通道六十一
38服务器node14：通道六十二、通道六十三、通道六十四、通道六十五
33服务器node15：通道六十六、通道六十七、通道六十八、通道六十九、通道七十
40服务器node16：通道七十一、通道七十二、通道七十三、通道七十四、通道七十五
40服务器node17：通道七十六、通道七十七、通道七十八、通道七十九、通道八十
41服务器node18：通道八十一、通道八十二、通道八十三、通道八十四、通道八十五
41服务器node19：通道八十六、通道八十七、通道八十八、通道八十九、通道九十
33服务器node20：通道九十一、通道九十二、通道九十三、通道九十四、通道九十五
42服务器node21：通道九十六、通道九十七、通道九十八、通道九十九、通道一百
42服务器node22: 通道一百零一、通道一百零二、通道一百零三、通道一百零四

可以看到那个通道是在那服务器上面都记录了

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps123.jpg) 

 

（7）如果出栈服务器启停之后，线程状态只有四个，此时需要通过数据库超级管理员和C##Xstreamadmin管理员去授权

登录数据库服务器

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps124.jpg) 

sqlplus [c##xstrmadmin/xstrmadmin@10.216.3.44:1522/QTCTB](mailto:c##xstrmadmin/xstrmadmin@10.216.3.44:1522/QTCTB)

或者

sqlplus / as sysdba

登录数据库

使用下面的sql去授权

需要关闭通道之后，去授权

BEGIN

  DBMS_XSTREAM_ADM.ALTER_OUTBOUND(

   server_name  => 'td12', -- 需要授权出栈服务器的名称

   connect_user => 'c##xstrm'

  );

END; 

### **5.2.2 管道挂起的处理方式**

如果是有新增字段的时候这样处理

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps125.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps126.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps127.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps128.jpg) 

通过以上报错可以看出应该是有字段新增了。

查看通道8属于什么业务系统的，查看起对应的源端和目标端的数据库字段对比

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps129.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps130.jpg) 

可以很明显看出字段少一个。

给目标端添加字段，

此时需要注意，该字段是不是属于回流字段，如果是就需要将生产同步库，回流库，各地市库都加上该字段

生产同步库：

alter table einp_settle.IC95 Add (AAZ884 NUMBER(20,0));

 

这个是17个回流库需要加的字段：

alter table einp_settle6201.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6202.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6203.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6204.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6205.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6206.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6207.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6208.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6209.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6210.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6211.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6212.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6229.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6230.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6270.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6271.IC95 Add (AAZ884 NUMBER(20,0));

alter table einp_settle6299.IC95 Add (AAZ884 NUMBER(20,0));

 

各个地市库: 分别是白银，酒泉，金昌等等

alter table LM_VT.DC01 Add (AAC073 varchar2(500));

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps131.jpg) 

 

### **5.2.3 A端数据库新增了一个字段，如何在B、C和D中新增**

首先，停止A-B的通道，B-C的通道不需要停止。

增加B中的字段

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps132.jpg) 

然后增加C的字段

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps133.jpg) 

最后在一个一个增加地市的库

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps134.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps135.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps136.jpg) 

等等。

 

### **5.2.4 A-B或者B-C通道因为某一张或者某几张表出现问题，导致通道增量运行停止了**

原因：可能是某一张表或者几张表有大数据增量业务（一亿条的修改）

处理方式：

找到这个通道的CDC(源端的CDC)

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps137.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps138.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps139.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps140.jpg) 

将数据库schema一栏的中出问题的表，去掉，保存（做好去除表的记录，后续会再加上）

然后重启启动通道。

但是这几张表的数据还是要的，处理方式：

如果是业务方，大数据处理完成了，我这边停止通道，查看对应的CDC,将之前去掉的表再加回去，保存，启动通道。

然后将之前去除的表，要做全量：处理方式：

A-B-C-D的全量：

1、A-B做全量，但是B后面存在C,C后面存在D，此时需要注意

1、A中的CDC之前的表除去了，现在又加上了，需要B后面的C和D不受到增量数据的影响，安装一下步骤处理：

a、停止A-B之间的通道，B-C之间的通道，C-D之间的通道

b、将B-C、C-D通道里面的CDC配置,里面关于A-B要做全量的表除去。

c、立刻将B-C，C-D通道启动，

d、开始A-B的全量，此时A-B的通道是停止的。

e、A-B的全量做完了之后，启动A-B的通道

f、A-B的全量做完了，需要等待一天之后在开始做B-C的全量，让B-C的归档时间往后移

g、B-C的全量做完了，等待一天之后再开始做C-D的全量

【注】全量之前，清理目标端的表空间。

### **5.2.5 管道停止不能超过七天**

管道停止不能超过七天，若是超过了七天，那么出栈服务器的状态就会报错。

所有现在已经停止的通道，后续要是重新开启的话，要重新创建出栈服务器 

如果该通道是启动状态的，但是七天内没有增量数据交换，出栈服务器七天没有捕获归档时间会导致出栈服务器状态报错。此时出栈服务器就会报错。 

如果事mysql数据库的话，没有出栈服务器，直接启停就可以了

### **5.2.5 通道恢复的注意事项**

当一个node节点上有几个通道需要恢复的话

关闭通道

关闭出栈服务器

查询出栈服务器的状态，可能会有一个进程没有关掉，等一段时间就会关掉。

启动出栈服务器

查看出栈服务器状态  --四个状态

打开通道日志

启动通道 

【注意】当一个节点上有几个通道需要恢复的话，如果日志里面频繁刷6000数据量就是说明该通道有数据堆积。此时让这个通道先运行一段时间之后，在恢复其他的通道，防止下一个通道也有数据堆积，同时开启可能会造成服务器压力。 

### **5.2.6 检查通道是否正常运行流程**

（1）连接数据库检查出栈服务器状态是否正常，

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps141.jpg) 

（2）查看运行日志

找到该通道具体的存在的服务器节点

具体可见：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps142.jpg) 

其中node1，node2，node3，node4 在服务器里都是node目录，其他正常。

通道查看日志

/opt/tongtech/TongDSP/node/logs/select 目录下

可以查看具体通道10的日志就是:

tail -f row_select.log | grep "pipelineId = 10"

 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps143.jpg) 

 

如下图：

数字目录代表该通道下的管道日志，源端为Oracle19c数据库一般只查看select目录日志即可，

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps144.jpg) 

源端为mysql5.7数据库，select目录就不打印日志，具体的需要去管道目录查看日志

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps145.jpg) 

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps146.jpg) 

日志无明显报错，且页面管道没有时间没有延迟，最后同步时间和最后位点时间于现实时间相差不大即可。

#  **6.** 问题集

## **6.1** 通道堵塞导致增量数据暂停

发生时间：2024年5月31日

### **6.1.1 问题发生场景**

客户在使用大屏过程中，发现大屏数据停止更新，要求我司技术人员进行排查。

### **6.1.2 问题描述及现象**

通道45，大屏相关业务数据，DSP数据同步任务报错停止，数据无法进行增量同步，具体报错信息如下图：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps147.jpg) 

### **6.1.3 问题解决过程**

1）对日志进行分析，发现是数据解析错误，对应报错的表为lm-el.cc03。

2）对比源和目标的表结构，确认当前时间点源表和目标表表结构一致。

3）根据以往经验，此问题与表结构发生变化的可能性比较大，但当前时刻表结构是一致的，遂怀疑中间有字段进行过变更。

4）与业务方进行确认后，发现该表确实中间增加过字段，后来又删除掉了，且时间与任务停止时间大致匹配。

5）针对此问题，按照如下过程进行处理，问题得以解决。

  (1)、停止dsp流程；

(2)、去掉有问题的表；

(3)、停止出栈服务器；

(4)、dsp正常运行过去以后停止dsp流程（如果有可能清除掉缓存文件）；

(5)、删除有问题表的目标表数据，执行全量同步；

(6)、将有问题的表添加到DSP流程并启动；

## **6.2** 使用ETL执行全量数据同步，存在部分数据入库不成功问题

发生时间：2024年6月4日

### **6.2.1 问题发生场景**

在处理DSP数据同步问题时，使用ETL对一张表进行数据全量同步，该表源端为oracle，目标端为mysql，数据规模3000多万条数据

### **6.2.2 问题描述及现象**

ETL全量同步3000万条数，同步完成后发现源表和目标表数据对不上，目标和源端相差5000条数据，发现错误日志信息如下：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps148.jpg) 

### **6.2.3 问题解决过程**

1）用条件限制，单独执行日志里面反馈的数据，日志里面数据同步成功了。

2）重复执行全量同步，发现每次都差5000条数据，过程中资源占用率并不高，源和目标数据库、表、字段的字符集编码是一致的。

3）与研发沟通后，怀疑跟单个批次执行的数据量太多有问题，遂将单个批次1000插入1000条数据修改为500条，此时对比源和目标，发现数据差异是2500条。

4）根据上述现象，发现一个规律，就是数据差异都是5个批次的数据进不去。

5）与产品研发确认后，取消批量入库模式，精准定位错误数据，发现有5条数据中文字段存在特殊字符的情况，如下图:

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps149.jpg) 

类似问题数据有5条，对应主键信息为 AAZ745（主键）：62202209081328500004、62202211151660020004、62202306081809020003、62202306081809020002、6220220803110526586

6）将问题上报总集山大地纬，总集出面找业务方对有问题的数据进行了处理，问题处理完成。

## **6.3** Xstream在Oracle19C下开启不成功

发生时间：2024年6月5日

### **6.3.1 问题发生场景**

客户提出新的需求，需要同步社保卡的数据到生产同步库，社保卡数据库是首次进行数据同步，没有执行过增量同步，需要实施人员按照手册内容在oracle19c数据库，开启xstream服务，配置并启动dsp任务。 

### **6.3.2 问题描述及现象**

实施人员按照文档步骤开启数据库的xstream服务，配置dsp任务后对任务进行启动，发现dsp任务无法启动，日志提示通道进程不存在：

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps150.png) 

### **6.3.3 问题解决过程**

1）初步怀疑是权限设置有问题，重复设置权限以后，问题仍未得到解决。

![img](_media\甘肃省人力资源和社会保障厅信息化总集成项目实施工作流程\wps151.jpg) 

2）经过反复测试验证，发现使用syadba用户启动通道，顺利启动成功，且日志同步正常。

##  